webpackJsonp([191],{1508:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(62),d=n(i),r=a(174),o=n(r),u=a(136),c=n(u),s=a(28),f=n(s),l=a(29),p=n(l),g=a(124),h=n(g),y=a(125),m=n(y),v=a(27),S=n(v),_=a(54),k=function(e){function t(e){(0,f.default)(this,t);var a=(0,h.default)(this,(t.__proto__||(0,c.default)(t)).call(this,e));return a.state={},a}return(0,m.default)(t,e),(0,p.default)(t,[{key:"componentDidMount",value:function(){document.title="微信支付",(0,_.share)("wechatpay",{corner:0});var e=this.props.location.query;if(!e.amount||!e.orderid)return void o.default.fail("缺少必要信息",2);this.fetch(e)}},{key:"fetch",value:function(e){var t=this;o.default.loading("加载中...",0),(0,_.post)("http://credit.xianjincard.com/v2/credit-card/get-wx-pay-args",{amount:e.amount,orderId:e.orderid}).then(function(e){return e.data}).then(function(a){if(o.default.hide(),0!==a.code)return void o.default.fail(a.message,2);t.setState({appId:a.data.appId,timeStamp:a.data.timeStamp,signType:a.data.signType,packageStr:a.data.package,nonceStr:a.data.nonceStr,paySign:a.data.paySign,echoStr:(0,d.default)(a.data),orderid:e.orderid,return_url:a.return_url},function(){"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",this.onBridgeReady,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",this.onBridgeReady),document.attachEvent("onWeixinJSBridgeReady",this.onBridgeReady)):this.onBridgeReady()})})}},{key:"onBridgeReady",value:function(){var e=this.state.return_url;WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:this.state.appId,timeStamp:this.state.timeStamp,nonceStr:this.state.nonceStr,package:this.state.packageStr,signType:this.state.signType,paySign:this.state.paySign},function(t){"get_brand_wcpay_request:ok"===t.err_msg?window.location.replace(e):(o.default.fail("支付未成功",3),setTimeout(function(){window.history.go(-1)},3e3))})}},{key:"render",value:function(){return S.default.createElement("div",null)}}]),t}(S.default.Component);t.default=k,e.exports=t.default}});