{"version":3,"sources":["src\\js\\pages\\misc\\app-mart\\index.js"],"names":["Approve","props","onEndReached","event","state","isLoading","hasMore","console","log","setState","setTimeout","load_list","dataSource","DataSource","rowHasChanged","row1","row2","status","ad_list","type_list","cloneWithRows","page","rawData","document","title","loading","type_id","then","data","that","response","code","fail","message","type","splice","i_count","parseInt","length","i","temp","k","push","ads","hide","offset","limit","models","id","install_url","e","stopPropagation","preventDefault","app_id","window","location","href","row","rowData","sectionID","rowID","obj","toDetailClick","bind","icon_small","name","size","handleClick","brief_info","separator","map","item","link","img","index","item2","index2","handleTypeJump","scrollbars","overflow","Component"],"mappings":"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","file":"index.js","sourceRoot":"E:/MyStudy/Redux/app_four","sourcesContent":["import React, {Component}  from 'react'\r\nimport {Carousel, List, Modal, Icon, Toast, Flex, ListView} from 'antd-mobile';\r\nimport {get, post, login, redirect, callBrowser} from 'utils'\r\nimport 'scss/misc/app-mart.component.scss'\r\n\r\n\r\n\r\n\r\nexport default class Approve extends React.Component {\r\n    //初始化加载\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        console.log(\"c\")\r\n        const dataSource = new ListView.DataSource({\r\n            rowHasChanged: (row1, row2) => row1 !== row2,\r\n        });\r\n\r\n        this.state = {\r\n            status : 1,\r\n            ad_list : [],\r\n            type_list : [],\r\n            dataSource: dataSource.cloneWithRows([]),\r\n            isLoading: true,\r\n            page : 1,\r\n            rawData : []\r\n        };\r\n    }\r\n\r\n    componentWillMount(){\r\n        document.title = '应用市场';\r\n        Toast.loading(\"加载中...\", 0);\r\n\r\n        post('http://credit.xianjincard.com/appstore/index',{type_id : 1}).then(data => data.data).then(response => {\r\n            var that = this;\r\n            if(response.code != 0) {\r\n                Toast.fail(response.message, 1.5);\r\n                this.setState({status : 0 }, function () {\r\n                    //console.log(111)\r\n                });\r\n                return;\r\n            }\r\n            var type_list = [];\r\n            response.data.type.splice(0,1);\r\n            var i_count = parseInt(response.data.type.length / 4);\r\n            if(i_count > 0) {\r\n                for (var i = 0; i < i_count; i++) {\r\n                    var temp = [];\r\n                    for (var k = 0; k < 4; k++) {\r\n                        temp.push(response.data.type[(i * 4 + k)]);\r\n                    }\r\n                    type_list.push(temp);\r\n                }\r\n            }else{\r\n                var temp = [];\r\n                for (var i = 0; i < response.data.type.length; i++) {\r\n                    temp.push(response.data.type[i]);\r\n                }\r\n                type_list.push(temp);\r\n            }\r\n            this.setState({status : 1 , ad_list : response.data.ads , type_list : type_list }, function () {\r\n                Toast.hide();\r\n                console.log(this.state)\r\n            });\r\n        });\r\n\r\n        this.load_list()\r\n    }\r\n\r\n    onEndReached = (event) => {\r\n        // load new data\r\n        // hasMore: from backend data, indicates whether it is the last page, here is false\r\n        if (this.state.isLoading && !this.state.hasMore) {\r\n            return;\r\n        }\r\n        console.log('reach end', event);\r\n        this.setState({ isLoading: true });\r\n        setTimeout(() => {\r\n            this.load_list()\r\n        }, 1000);\r\n    }\r\n\r\n    load_list() {\r\n        post('http://credit.xianjincard.com/appstore/apps',{\r\n            offset : (this.state.page-1)*10,\r\n            limit : 10,\r\n            type_id : 1\r\n        }).then(data => data.data).then(response => {\r\n            console.log()\r\n            var that = this;\r\n            if(response.code != 0) {\r\n                Toast.fail(response.message, 1.5);\r\n                this.setState({status : 0 }, function () {\r\n                    //console.log(111)\r\n                });\r\n                return;\r\n            }\r\n            if(response.data.models.length <= 0){\r\n                return;\r\n            }\r\n            //console.log(response.data.models)\r\n            this.setState({rawData : [...this.state.rawData, ...response.data.models]},function () {\r\n                this.setState({\r\n                    dataSource: this.state.dataSource.cloneWithRows(this.state.rawData),\r\n                    isLoading: false,\r\n                    page : this.state.page+1\r\n                }, function () {\r\n                    Toast.hide();\r\n                    console.log(this.state.page)\r\n                });\r\n            })\r\n\r\n        });\r\n    }\r\n\r\n    componentDidMount() {\r\n        //console.log(\"b\")\r\n    }\r\n\r\n    fetchData() {\r\n        // get('http://credit.xianjincard.com/credit-app/multi-index').then(result => {console.log(result)})\r\n    }\r\n    handleClick(id, install_url, e){\r\n        e.stopPropagation()\r\n        e.preventDefault()\r\n        post('http://credit.xianjincard.com/appstore/action-log',{\r\n            app_id : id,\r\n            type : 1\r\n        }).then(data => data.data).then(response => {\r\n\r\n        });\r\n        // 下载app的方法\r\n        callBrowser(install_url)\r\n    }\r\n    toDetailClick(id, e){\r\n        window.location.href = \"app-mart/detail?id=\"+id;\r\n    }\r\n    handleTypeJump(id, e){\r\n        window.location.href = \"app-mart/cate?id=\"+id;\r\n    }\r\n    render() {\r\n        const row = (rowData, sectionID, rowID) => {\r\n            const obj = rowData\r\n            return (\r\n                <div key={rowID} class=\"item\" onClick={this.toDetailClick.bind(this, obj.id)}>\r\n                    <div class=\"icon\">\r\n                        <div class=\"img\">\r\n                            <img src={obj.icon_small} />\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"main-cont\">\r\n                        <div class=\"top\">\r\n                            <div class=\"left\">\r\n                                <p class=\"name\">\r\n                                    <span>{obj.name}</span>\r\n                                </p>\r\n                                <p class=\"size\">{obj.size}MB</p>\r\n                            </div>\r\n                            <div class=\"btn\">\r\n                                <a class=\"a-btn\" onClick={this.handleClick.bind(this, obj.id, obj.install_url)}>安装</a>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"info\">\r\n                            <p>{obj.brief_info}</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )\r\n        }\r\n        \r\n        const separator = (sectionID, rowID) => (\r\n            <div key={rowID} />\r\n        )\r\n        return (\r\n            <div class=\"app-mart\">\r\n                {this.state.ad_list.length > 0 ?\r\n                <div class='carousel'>\r\n                    <Carousel autoplay={true} infinite>\r\n                        {\r\n                            this.state.ad_list && this.state.ad_list.map(\r\n                                ({link, img} = item, index) => (\r\n                        <a key={index} href={link} class='slider-link'>\r\n                            <img src={img}/>\r\n                        </a>\r\n                                )\r\n                            )\r\n                        }\r\n                    </Carousel>\r\n                </div>\r\n                : \"\"}\r\n                {this.state.type_list.length > 0 ?\r\n                <div className={`type ${this.state.type_list.length > 1 ? 'yes-slide' : 'no-slide'}`}>\r\n                    <Carousel autoplay={false} >\r\n                        {\r\n                            this.state.type_list && this.state.type_list.map(\r\n                                (item, index) => (\r\n                                <div key={index} class='slider-link2'>\r\n                                    {\r\n                                        item && item.map(\r\n                                            ({id, name, img} = item2, index2) => (\r\n                                            <div key={index2} class=\"block\" onClick={this.handleTypeJump.bind(this, id)}>\r\n                                                <div class=\"pd\">\r\n                                                    <div class=\"block-in\">\r\n                                                        <div class=\"icon\">\r\n                                                            <img src={img}/>\r\n                                                        </div>\r\n                                                        <div class=\"title\">\r\n                                                            <p>{name}</p>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                            )\r\n                                        )\r\n                                    }\r\n                                </div>\r\n                                )\r\n                            )\r\n                        }\r\n                    </Carousel>\r\n                </div>\r\n                :\"\"}\r\n                <div class=\"list\">\r\n                    <ListView\r\n                        ref='lvOne'\r\n                        dataSource={this.state.dataSource}\r\n                        renderRow={row}\r\n                        renderSeparator={separator}\r\n                        initialListSize={20}\r\n                        pageSize={20}\r\n                        scrollRenderAheadDistance={200}\r\n                        scrollEventThrottle={20}\r\n                        className='listview'\r\n                        scrollerOptions={{ scrollbars: false }}\r\n                        onEndReached={this.onEndReached.bind(this)}\r\n                        onEndReachedThreshold={10}\r\n                        style={{\r\n                            overflow : 'hidden'\r\n                        }}\r\n                    />\r\n\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n"]}