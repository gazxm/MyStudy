{"version":3,"sources":["src\\js\\pages\\mobile\\misc\\Loan.js"],"names":["Item","AgreeItem","isIPhone","RegExp","test","window","navigator","userAgent","maskProps","onTouchStart","e","preventDefault","Loan","props","onChange","i","hide","setState","couponIndex","params","coupon_id","state","coupon_list","replace","card_type","period","money","fetchData","true_money","counter_fee","bank_name","card_no","coupon_total","real_pay_pwd_status","tips","agree","loading","then","result","data","code","info","message","goBack","item","catch","error","couponList","map","rowData","title","parseInt","use_case","amount","bind","coupon_name","loan_amount","loan_term","time","length","show","onCancel","animationType","maskClosable","console","log","push","hasPay","onConfirm","onPassword","value","confirm","password","pay_password","remove","tick","setPassword","old","amountStr","undefined","v","str_amount","onSelected","__html","onSubmit","onAgree","protocol_url","Component"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AAMA;;AACA;;AACA;;;;AACA;;;;;;;;AAPA,IAAM,OAAO,eAAb,AAAkB;AAClB,IAAM,YAAY,mBAAlB,AAA2B;AAC3B;AACA;;;AAMA,IAAM,WAAW,IAAA,AAAI,OAAJ,AAAW,2BAAX,AAAsC,KAAtC,AAA2C,KAAK,OAAA,AAAO,UAAxE,AAAiB,AAAiE;AAClF,IAAI,iBAAJ;AACA,IAAA,AAAI,UAAU,AACZ;AACA;;kBACgB,yBAAA;aAAK,EAAL,AAAK,AAAE;AADvB,AAAY,AAGb;AAHa,AACV;;;IAIiB,A;gCACnB;;gBAAA,AAAa,OAAO;wCAAA;;kIAAA,AACZ;;UADY,AA+DpB,WAAW,UAAA,AAAC,GAAM,AAChB;sBAAA,AAAM,AACN;YAAA,AAAK,SAAS,EAAC,aAFC,AAEhB,AAAc,AAAc;UAFZ,AAGT,SAAU,MAHD,AAGM,MAHN,AAGT,AACP;;aAAA,AAAO,YAAY,MAAA,AAAK,MAAL,AAAW,YAAX,AAAuB,GAA1C,AAA6C,AAC7C;AACA;sBAAA,AAAS,0BAAwB,OAAjC,AAAwC,kBAAa,OAArD,AAA4D,eAAU,OAAtE,AAA6E,cAAS,OAAtF,AAA6F,AAC7F;YAAA,AAAK,UAAL,AAAe,AAChB;AAvEmB,AAElB;;UAAA,AAAK;aAAQ,AACJ,AACP;cAFW,AAEH,AACR;kBAHW,AAGC,AACZ;mBAJW,AAIE,AACb;iBALW,AAKA,AACX;eANW,AAMF,AACT;oBAPW,AAOG,AACd;mBARW,AAQE,AACb;2BATW,AASU,AACrB;YAVW,AAUL,AACN;mBAAa,CAXF,AAWG,AACd;aAdgB,AAElB,AAAa,AAYJ;AAZI,AACX;WAaH;;;;;wCACoB,AACnB;WAAA,AAAK,UAAU,KAAA,AAAK,MAApB,AAA0B,AAC1B;AACD;;;;8B,AACU,QAAQ;mBACjB;;sBAAA,AAAM,QAAN,AAAc,AACd;uBAAA,AAAK,8DAAL,AAAmE,QAAnE,AAA2E,KAAK,UAAA,AAAC,QAAW,AAC1F;wBAAA,AAAM,AACN;AACA;YAAI,OAAA,AAAO,KAAP,AAAY,SAAS,CAAzB,AAA0B,GAAG,AAC3B;0BAAA,AAAM,KAAK,OAAA,AAAO,KAAlB,AAAuB,SAAvB,AAAgC,GAAG,YAAM,AACvC;4BAAA,AAAS,AACV;AAFD,AAGA;AACD;AACD;YAAI,OAAA,AAAO,KAAP,AAAY,SAAhB,AAAyB,GAAG,AAC1B;0BAAA,AAAM,KAAK,OAAA,AAAO,KAAlB,AAAuB,SAAvB,AAAgC,AAChC;AACD;AACD;AACA;YAAI,OAAA,AAAK,MAAL,AAAW,gBAAgB,CAA/B,AAAgC,GAAG,AACjC;iBAAA,AAAO,KAAP,AAAY,KAAZ,AAAiB,KAAjB,AAAsB,cAAtB,AAAoC,AACrC;AACD;eAAA,AAAK,oCAAa,OAAA,AAAO,KAAP,AAAY,KAA9B,AAAmC,AACnC;AACD;AAnBD,SAAA,AAmBG,MAAM,iBAAA;eAAA,AAAS;AAnBlB,AAoBD;;;;yB,AACK,YAAY;mBAChB;;wBAAO,AAAW,IAAI,UAAA,AAAC,SAAD,AAAU,GAAM,AACpC;YAAM,QAAQ,SAAS,QAAT,AAAiB,cAAjB,AAA+B,IAAI,gBAAA,cAAA,MAAK,cAAxC,AAAmC,AAAa,SAAc,gBAAA,cAAA,MAAI,sBAAA,cAAA,KAAA,MAAJ,AAAI,AAAS,mBAAzF,AAA4E,AAAqB,AACjG;eACE,gBAAA,cAAA,SAAK,KAAL,AAAU,GAAG,WAAb,AAAmB,eAAc,SAAS,OAAA,AAAK,SAAL,AAAc,aAAxD,AAA0C,AAAyB,AACjE,sBAAA,cAAA,QAAO,MADT,AACE,AACA,wBAAA,cAAA,UAAM,WAAN,AAAY,AACV,4BAAA,cAAA,OACE,sBAAA,cAAA,MAAK,cADP,AACE,AAAa,AACb,8BAAA,cAAA,KAAI,cAFN,AAEE,AAAY,AACZ,8BAAA,cAAA,KAAI,cAHN,AAGE,AAAY,AACZ,4BAAA,cAAA,KAAI,cAJN,AAIE,AAAY,AACZ,4CAAG,WAAO,MAAM,OAAA,AAAK,MAAX,AAAiB,eATnC,AACE,AAEE,AACE,AAKE,AAA0C,AAKnD;AAhBD,AAAO,AAiBR,OAjBQ;;;;iCA2BK;UAAA,AACL,cAAe,KADV,AACe,MADf,AACL,AACP;;UAAI,YAAA,AAAY,UAAhB,AAA0B,GAAG,AAE7B;;sBAAA,AAAM,qBACJ,cAAA,SAAK,WAAL,AAAW,AACT,gCAAA,cAAA,MAAA,MAAS,kFAAM,MAAN,AAAW,SAAQ,SAAS,mBAAM,AAAE;0BAAA,AAAM,AAAQ;AAD7D,AACE,AAAS,AACT,aAFF,kBAEE,cAAA,SAAK,WAAL,AAAW,AACT,6BAAA,cAAA,SAAK,WAAL,AAAW,AAAQ,eAAA,AAAK,KAD1B,AACE,AAAmB,AAAU,AAC7B,+BAAA,cAAA,SAAK,WAAL,AAAW,AAAS,4BAAA,uBAAA,WAAQ,WAAR,AAAkB,OAAM,SAAS,KAAA,AAAK,SAAL,AAAc,KAA/C,AAAiC,AAAmB,SAL9E,AACE,AAEE,AAEE,AAAoB,4CAGxB,EAAE,eAAF,AAAiB,YAAY,WAA7B,WAAwC,cAR1C,AAQE,AAAsD,AAEzD;;;;+BACW,AACV;sBAAA,AAAM,AACN;WAAA,AAAK,SAAS,EAAC,aAAa,CAFlB,AAEV,AAAc,AAAe;UAFnB,AAGH,SAAU,KAHP,AAGY,MAHZ,AAGH,AACP;;cAAA,AAAQ,IAAR,AAAY,AACZ;sBAAA,AAAS,uBAAqB,OAA9B,AAAqC,kBAAa,OAAlD,AAAyD,eAAU,OAAnE,AAA0E,AAC3E;;;;4BACQ,A,GAAG,AACV;WAAA,AAAK,SAAS,EAAC,OAAO,CAAC,KAAA,AAAK,MAA5B,AAAc,AAAoB,AACnC;;;;+BACW;UAAA,AACkB,SAAU,KAD5B,AACiC,MADjC,AACH,AACX;AACI;;iBAAA,AAAW,IAAI,KAAf,AAAe,AAAK,cAAc,KAAlC,AAAkC,AAAK,AACxC;;;;gCACY;mBACX;;yBAAA,AAAS,KAAK,UAAA,AAAC,OAAU,AACvB;eAAA,AAAK,QAAL,AAAa,AACd;AAFD,SAAA,AAEG,AACJ;;;;4B,AACQ,UAAU;UAAA,AACZ,SAAU,KADE,AACG,MADH,AACZ,AACL;;aAAA,AAAO,eAAP,AAAsB,AACtB;sBAAA,AAAM,QAAN,AAAc,AACd;uBAAA,AAAK,wDAAL,AAA6D,QAA7D,AAAqE,KAAK,UAAA,AAAC,QAAW,AACpF;wBAAA,AAAM,AACN;AACA;YAAI,OAAO,OAAX,AAAkB,AAClB;YAAI,KAAA,AAAK,SAAT,AAAkB,GAAG,AACnB;6BAAA,AAAS,AACT;AACD;AACD;YAAI,KAAA,AAAK,SAAT,AAAkB,GAAG,AACnB;AACA;6BAAA,AAAS,AACT;mCAAa,KAAA,AAAK,KAAlB,AAAuB,AACvB;0BAAA,AAAS,KAAT,AAAc,AACd;AACD;AACD;wBAAA,AAAM,KAAK,KAAX,AAAgB,SAAhB,AAAyB,AAC1B;AAhBD,AAiBD;;;;iCACa;mBACZ;;yBAAA,AAAS,KAAK,UAAA,AAAC,OAAU,AACvB;2BAAA,AAAS,KAAK,UAAA,AAAC,UAAa,AAC1B;iBAAA,AAAK,YAAL,AAAiB,OAAjB,AAAwB,AACzB;AAFD,WAAA,AAEG,AACJ;AAJD,SAAA,AAIG,AACJ;;;;gCACY,A,K,AAAK,UAAU;mBAC1B;;cAAA,AAAQ,IAAR,AAAY,KAAZ,AAAiB,AACjB;UAAI,QAAJ,AAAY,UAAU,AACpB;2BAAA,AAAS,MAAT,AAAe,AACf;AACD;AACD;sBAAA,AAAM,QAAN,AAAc,AACd;uBAAA,AAAK,6DAA6D,EAAC,YAAnE,AAAkE,AAAa,YAA/E,AAA0F,KAAK,UAAA,AAAC,QAAW,AAC3G;AACE;wBAAA,AAAM,AACN;YAAI,OAAA,AAAO,KAAP,AAAY,SAAhB,AAAyB,GAAG,AAC1B;0BAAA,AAAM,KAAK,OAAA,AAAO,KAAlB,AAAuB,SAAvB,AAAgC,GAAG,YAAM,AACvC;mBAAA,AAAK,AACN;AAFD,AAGA;AACD;AACD;wBAAA,AAAM,KAAK,OAAA,AAAO,KAAlB,AAAuB,SAAvB,AAAgC,AACjC;AAVD,AAWD;;;;6BACS;mBACR;;UAAM,OAAO,KAAb,AAAkB,AAClB;UAAI,YAAJ,AAAgB,AAChB;UAAI,KAAA,AAAK,YAAL,AAAiB,SAArB,AAA8B,GAAG,AAC/B;YAAI,KAAA,AAAK,eAAT,AAAwB,GAAG,AACzB;sBAAY,KAAA,AAAK,YAAY,KAAjB,AAAsB,aAAlC,AAAY,AAAmC,AAChD;AAFD,eAEO,IAAI,KAAA,AAAK,MAAL,AAAW,OAAX,AAAkB,cAAtB,AAAoC,WAAW,AACpD;eAAA,AAAK,YAAL,AAAiB,IAAI,UAAA,AAAC,GAAD,AAAI,GAAM,AAC7B;gBAAI,SAAS,EAAT,AAAW,eAAe,SAAS,OAAA,AAAK,MAAL,AAAW,OAAlD,AAA8B,AAA2B,YAAY,AACnE;mBAAA,AAAK,cAAL,AAAmB,AACnB;0BAAY,EAAZ,AAAc,AACd;AACD;AACF;AAND,AAOD;AACF;AAZD,aAYO,AACL;oBAAA,AAAY,AACb;AACD;AACA;aACE,gBAAA,cAAA,SAAK,WAAL,AAAW,AACT,kCAAA,qBAAA,WAAM,WAAN,AAAY,AACV,+BAAC,cAAD,QAAM,OAAO,KAAA,AAAK,QAAlB,AAA0B,SAD5B,AACE,AACA,6CAAC,cAAD,QAAM,OAAO,KAAA,AAAK,SAAlB,AAA2B,SAF7B,AAEE,AACA,6CAAC,cAAD,QAAM,OAAO,KAAA,AAAK,aAAlB,AAA+B,SAHjC,AAGE,AACA,6CAAC,cAAD,QAAM,OAAO,KAAA,AAAK,cAAlB,AAAgC,SAJlC,AAIE,AACA,6CAAC,cAAD,QAAM,OAAO,KAAb,AAAkB,aALpB,AAKE,AACA,6CAAC,cAAD,QAAM,OAAO,KAAb,AAAkB,WAPtB,AACE,AAME,AAEF,8CAAA,qBAAA,WAAM,WAAN,AAAY,AAAc,iCAAC,cAAD,QAAM,WAAO,KAAA,AAAK,eAAL,AAAoB,KAAjC,AAAsC,WAAW,OAAjD,AAAwD,WAAW,OAAO,CAAA,AAAC,aAA3E,AAAwF,cAAc,SAAS,KAAA,AAAK,WAAL,AAAgB,KAA/H,AAA+G,AAAqB,SAAU,sCAAA,cAAA,KAAI,WAAJ,AAAS,cATnL,AASE,AAA0B,AAA8I,AACxK,oEAAG,WAAH,AAAS,QAAO,yBAAyB,EAAC,QAAQ,KAAA,AAAK,KAAL,AAAU,QAAV,AAAkB,gBAVtE,AAUE,AAAyC,AAAS,AAAkC,AACpF,mCAAA,cAAA,SAAK,WAAL,AAAW,AAAS,4BAAA,uBAAA,WAAQ,UAAU,CAAC,KAAnB,AAAwB,OAAO,MAA/B,AAAoC,WAAU,SAAS,KAAA,AAAK,SAAL,AAAc,KAArE,AAAuD,AAAmB,SAXhG,AAWE,AAAoB,AACpB,8CAAC,cAAD,aAAW,aAAX,AAAqB,SAAQ,gBAAgB,KAA7C,AAAkD,OAAO,UAAU,KAAA,AAAK,QAAL,AAAa,KAAhF,AAAmE,AAAkB,SAC5E,8DAAA,cAAA,OAAG,MAAM,KAAT,AAAc,gBAbzB,AAYE,AACS,AAET,iFAAK,WAhBT,AACE,AAeE,AAAW,AAGhB;;;;EAlM+B,gBAAM,A;;kBAAnB,A","file":"Loan.js","sourceRoot":"E:/MyStudy/Redux/app_four","sourcesContent":["import React from 'react'\r\nimport { Icon, List, Button, Checkbox, Popup } from 'antd-mobile'\r\nconst Item = List.Item\r\nconst AgreeItem = Checkbox.AgreeItem\r\n// const alert = Modal.alert\r\n// const CheckboxItem = Checkbox.CheckboxItem\r\nimport {post, redirect, sendEventSDK} from 'utils'\r\nimport 'scss/mobile/loan.component.scss'\r\nimport Toast from 'components/Toast'\r\nimport Password from 'components/Password'\r\n\r\nconst isIPhone = new RegExp('\\\\biPhone\\\\b|\\\\biPod\\\\b', 'i').test(window.navigator.userAgent)\r\nlet maskProps\r\nif (isIPhone) {\r\n  // Note: the popup content will not scroll.\r\n  maskProps = {\r\n    onTouchStart: e => e.preventDefault()\r\n  }\r\n}\r\n\r\nexport default class Loan extends React.Component {\r\n  constructor (props) {\r\n    super(props)\r\n    this.state = {\r\n      money: '',\r\n      period: '',\r\n      true_money: '',\r\n      counter_fee: '',\r\n      bank_name: '',\r\n      card_no: '',\r\n      coupon_total: '',\r\n      coupon_list: [],\r\n      real_pay_pwd_status: '',\r\n      tips: '',\r\n      couponIndex: -1,\r\n      agree: true\r\n    }\r\n  }\r\n  componentDidMount () {\r\n    this.fetchData(this.props.params)\r\n    // console.log(this.props)\r\n  }\r\n  fetchData (params) {\r\n    Toast.loading('加载中...')\r\n    post('http://credit.xianjincard.com/credit-loan/get-confirm-loan', params).then((result) => {\r\n      Toast.hide()\r\n      // 不能再借\r\n      if (result.data.code === -1) {\r\n        Toast.info(result.data.message, 2, () => {\r\n          redirect.goBack()\r\n        })\r\n        return\r\n      }\r\n      if (result.data.code !== 0) {\r\n        Toast.info(result.data.message, 2)\r\n        return\r\n      }\r\n      // 默认优惠券数组第一个是选中\r\n      if (this.state.couponIndex !== -1) {\r\n        result.data.data.item.couponIndex = 0\r\n      }\r\n      this.setState({...result.data.data.item})\r\n      // console.log(result)\r\n    }).catch(error => error)\r\n  }\r\n  item (couponList) {\r\n    return couponList.map((rowData, i) => {\r\n      const title = parseInt(rowData.use_case) === 4 ? <h3>{rowData.title}</h3> : <h4><i>￥</i>{rowData.amount}</h4>\r\n      return (\r\n        <div key={i} class=\"coupon-item\" onClick={this.onChange.bind(this, i)}>\r\n          <span>{title}</span>\r\n          <span class=\"active\">\r\n            <div>\r\n              <h3>{rowData.coupon_name}</h3>\r\n              <p>{rowData.loan_amount}</p>\r\n              <p>{rowData.loan_term}</p>\r\n              <p>{rowData.time}</p>\r\n              <b class={i === this.state.couponIndex && 'active'}></b>\r\n            </div>\r\n          </span>\r\n        </div>\r\n      )\r\n    })\r\n  }\r\n  onChange = (i) => {\r\n    Popup.hide()\r\n    this.setState({couponIndex: i})\r\n    const {params} = this.props\r\n    params.coupon_id = this.state.coupon_list[i].coupon_id\r\n    // console.log(params)\r\n    redirect.replace(`/mobile/loan/${params.card_type}/${params.period}/${params.money}/${params.coupon_id}`)\r\n    this.fetchData(params)\r\n  }\r\n  onSelected () {\r\n    const {coupon_list} = this.state\r\n    if (coupon_list.length <= 0) return\r\n\r\n    Popup.show(\r\n      <div class=\"loan-popup\">\r\n        <h1>可用优惠券<Icon type=\"cross\" onClick={() => { Popup.hide() }}/></h1>\r\n        <div class=\"content\">\r\n          <div class=\"warp\">{this.item(coupon_list)}</div>\r\n          <div class=\"button\"><Button className=\"btn\" onClick={this.onCancel.bind(this)}>不使用优惠券</Button></div>\r\n        </div>\r\n      </div>,\r\n      { animationType: 'slide-up', maskProps, maskClosable: false }\r\n    )\r\n  }\r\n  onCancel () {\r\n    Popup.hide()\r\n    this.setState({couponIndex: -1})\r\n    const {params} = this.props\r\n    console.log(params)\r\n    redirect.push(`/mobile/loan/${params.card_type}/${params.period}/${params.money}`)\r\n  }\r\n  onAgree (e) {\r\n    this.setState({agree: !this.state.agree})\r\n  }\r\n  onSubmit () {\r\n    const {real_pay_pwd_status: hasPay} = this.state\r\n//    console.log(real_pay_pwd_status)\r\n    hasPay === 1 ? this.onConfirm() : this.onPassword()\r\n  }\r\n  onConfirm () {\r\n    Password.show((value) => {\r\n      this.confirm(value)\r\n    }, '请输入交易密码')\r\n  }\r\n  confirm (password) {\r\n    let {params} = this.props\r\n    params.pay_password = password\r\n    Toast.loading('加载中...')\r\n    post('http://credit.xianjincard.com/credit-loan/apply-loan', params).then((result) => {\r\n      Toast.hide()\r\n      // console.log(result)\r\n      let data = result.data\r\n      if (data.code === 3) {\r\n        Password.error()\r\n        return\r\n      }\r\n      if (data.code === 0) {\r\n        // 借款成功\r\n        Password.remove()\r\n        sendEventSDK(data.item.tick)\r\n        redirect.push('/mobile/loan')\r\n        return\r\n      }\r\n      Toast.info(data.message, 2)\r\n    })\r\n  }\r\n  onPassword () {\r\n    Password.show((value) => {\r\n      Password.show((password) => {\r\n        this.setPassword(value, password)\r\n      }, '请确认交易密码')\r\n    }, '请设置交易密码')\r\n  }\r\n  setPassword (old, password) {\r\n    console.log(old, password)\r\n    if (old !== password) {\r\n      Password.error('两次输入交易密码不同')\r\n      return\r\n    }\r\n    Toast.loading('加载中...')\r\n    post('http://credit.xianjincard.com/credit-user/set-paypassword', {'password': password}).then((result) => {\r\n    //  console.log(result)\r\n      Toast.hide()\r\n      if (result.data.code === 0) {\r\n        Toast.info(result.data.message, 1, () => {\r\n          this.onConfirm()\r\n        })\r\n        return\r\n      }\r\n      Toast.info(result.data.message, 2)\r\n    })\r\n  }\r\n  render () {\r\n    const data = this.state\r\n    let amountStr = '不使用券'\r\n    if (data.coupon_list.length > 0) {\r\n      if (data.couponIndex >= 0) {\r\n        amountStr = data.coupon_list[data.couponIndex]['str_amount']\r\n      } else if (this.props.params.coupon_id !== undefined) {\r\n        data.coupon_list.map((v, i) => {\r\n          if (parseInt(v.coupon_id) === parseInt(this.props.params.coupon_id)) {\r\n            data.couponIndex = i\r\n            amountStr = v.str_amount\r\n            return\r\n          }\r\n        })\r\n      }\r\n    } else {\r\n      amountStr = ''\r\n    }\r\n    // <a href=\"\">《平台服务协议》</a><br/><a href=\"\">《授权扣款委托书》</a>\r\n    return (\r\n      <div class=\"loan-confirm\">\r\n        <List class=\"loan-list\">\r\n          <Item extra={data.money + '(元)'}>借款金额</Item>\r\n          <Item extra={data.period + '(天)'}>借款期限</Item>\r\n          <Item extra={data.true_money + '(元)'}>实际到帐</Item>\r\n          <Item extra={data.counter_fee + '(元)'}>服务费用</Item>\r\n          <Item extra={data.bank_name}>到帐银行</Item>\r\n          <Item extra={data.card_no}>取现卡号</Item>\r\n        </List>\r\n        <List class=\"select-item\"><Item class={data.couponIndex >= 0 && 'active '} extra={amountStr} arrow={!amountStr || 'horizontal'} onClick={this.onSelected.bind(this)}>可用券<i>{data.coupon_total}张可用券</i></Item></List>\r\n        <p class=\"info\" dangerouslySetInnerHTML={{__html: data.tips.replace(/(\\d+\\.?\\d+)/g, '<b>$1</b>')}}></p>\r\n        <div class=\"button\"><Button disabled={!data.agree} type=\"primary\" onClick={this.onSubmit.bind(this)}>确认申请</Button></div>\r\n        <AgreeItem data-seed=\"logId\" defaultChecked={data.agree} onChange={this.onAgree.bind(this)}>\r\n          我已阅读并同意<a href={data.protocol_url}>《借款协议》</a>\r\n        </AgreeItem>\r\n        <div class=\"bg-logo\"></div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n"]}