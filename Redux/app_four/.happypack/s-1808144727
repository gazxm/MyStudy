'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _css = require('antd-mobile/lib/toast/style/css');

var _toast = require('antd-mobile/lib/toast');

var _toast2 = _interopRequireDefault(_toast);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _rcForm = require('rc-form');

var _classnames = require('classnames');

var _classnames2 = _interopRequireDefault(_classnames);

require('scss/mobile/credit.component.scss');

var _request = require('common/request');

var _request2 = _interopRequireDefault(_request);

var _utils = require('utils');

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/* eslint-disable */
var title = '信用卡账单导入';

var Importing = function (_Component) {
    (0, _inherits3.default)(Importing, _Component);

    function Importing(props) {
        (0, _classCallCheck3.default)(this, Importing);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Importing.__proto__ || (0, _getPrototypeOf2.default)(Importing)).call(this, props));

        _this.state = {
            lock: 1,
            loaded: 0,
            loading: 0
        };
        return _this;
    }

    (0, _createClass3.default)(Importing, [{
        key: 'componentDidMount',
        value: function componentDidMount() {
            document.title = title;
            var type = this.props.location.query.type;

            var url = void 0;
            if (type == 'bank') {
                url = 'credit-card/get-online-banking-result';
            } else if (type == 'email') {
                url = 'credit-card/get-mail-verification-result';
            } else {
                _toast2.default.fail('缺少参数，请确认后再尝试', 1.5, function () {
                    setTimeout(_utils.redirect.goBack);
                });
                return;
            }
            this.query.bind(this)(url);
        }
    }, {
        key: 'query',
        value: function query(url) {
            var _this2 = this;

            var middleware = this.props.middleware;
            var type = this.props.location.query.type;

            _toast2.default.loading(undefined, 0);
            (0, _request2.default)(url).then(function (response) {
                var code = response.code,
                    message = response.message;

                _toast2.default.success(message, 1.5, function () {
                    setTimeout(_utils.redirect.replace('/mobile/certification/credit/import?success'));
                });
            }).catch(function (response) {
                var code = response.code,
                    message = response.message;

                _toast2.default.hide();
                if ([1, 3].indexOf(code) >= 0) {
                    _toast2.default.fail(message, 1.5, function () {
                        var route = void 0;
                        if (code == 1) {
                            route = '/mobile/certification/credit/import?fail';
                        } else if (code == 3) {
                            route = '/mobile/certification/credit/import/' + type;
                        }
                        setTimeout(function () {
                            _utils.redirect.push(route);
                        });
                    });
                } else if (code == 2) {
                    setTimeout(function () {
                        _this2.query.bind(_this2)(url);
                    }, 1500);
                } else {
                    _toast2.default.fail('服务器繁忙，请稍后重试', 1.5, function () {
                        setTimeout(_utils.redirect.goBack);
                    });
                }
            });
        }
    }, {
        key: 'render',
        value: function render() {
            return _react2.default.createElement('div', { className: 'importing' }, _react2.default.createElement('div', { className: 'header' }, _react2.default.createElement('div', null, _react2.default.createElement('div', { className: 'loading' }), _react2.default.createElement('div', { className: 'title' }, '\u4FE1\u7528\u5361\u8D26\u5355\u5BFC\u5165\u4E2D...'))), _react2.default.createElement('div', { className: 'footer' }, _react2.default.createElement('div', { className: 'security' }, '\u94F6\u884C\u7EA7\u6570\u636E\u52A0\u5BC6\u9632\u62A4')));
        }
    }]);
    return Importing;
}(_react.Component);

;

exports.default = (0, _rcForm.createForm)()(Importing);
module.exports = exports['default'];