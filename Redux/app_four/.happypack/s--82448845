'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = undefined;

var _css = require('antd-mobile/lib/card/style/css');

var _card = require('antd-mobile/lib/card');

var _card2 = _interopRequireDefault(_card);

var _css2 = require('antd-mobile/lib/carousel/style/css');

var _carousel = require('antd-mobile/lib/carousel');

var _carousel2 = _interopRequireDefault(_carousel);

var _css3 = require('antd-mobile/lib/flex/style/css');

var _flex = require('antd-mobile/lib/flex');

var _flex2 = _interopRequireDefault(_flex);

var _css4 = require('antd-mobile/lib/toast/style/css');

var _toast = require('antd-mobile/lib/toast');

var _toast2 = _interopRequireDefault(_toast);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _css5 = require('antd-mobile/lib/list/style/css');

var _list = require('antd-mobile/lib/list');

var _list2 = _interopRequireDefault(_list);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _classnames = require('classnames');

var _classnames2 = _interopRequireDefault(_classnames);

require('scss/mobile/find.component.scss');

var _request = require('common/request');

var _request2 = _interopRequireDefault(_request);

var _utils = require('utils');

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var title = '发现'; /* eslint-disable */

var subject = function subject(options) {
    var title = options.title,
        subtitle = options.subtitle,
        _options$extra = options.extra,
        extra = _options$extra === undefined ? '更多' : _options$extra,
        link = options.link;

    var click = function click() {
        typeof link === 'function' && link();
        /^(https?|\/\/)/.test(link) && (window.location.href = link);
    };
    return _react2.default.createElement(_list2.default, { className: 'subject' }, _react2.default.createElement(_list2.default.Item, { extra: extra, arrow: 'horizontal', onClick: click }, title, subtitle && _react2.default.createElement('span', null, subtitle)));
};
// {interestType == 0 ? '年' : interestType == 1 ? '月' : interestType == 2 ? '日' : '/'}

var Find = function (_Component) {
    (0, _inherits3.default)(Find, _Component);

    function Find(props) {
        (0, _classCallCheck3.default)(this, Find);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Find.__proto__ || (0, _getPrototypeOf2.default)(Find)).call(this, props));

        _this.state = {
            initialHeight: 200,
            loaded: 0
        };
        return _this;
    }

    (0, _createClass3.default)(Find, [{
        key: 'componentDidMount',
        value: function componentDidMount() {
            var _this2 = this;

            document.title = title;
            (0, _request2.default)('notice/discovery-channel').then(function (response) {
                var _response$data = response.data,
                    guides = _response$data.item,
                    entries = _response$data.personal,
                    cards = _response$data.card,
                    channels = _response$data.channel,
                    articles = _response$data.article,
                    carousels = _response$data.carousel;

                setTimeout(function () {
                    _this2.setState({
                        guides: guides,
                        entries: entries,
                        carousels: carousels,
                        cards: cards,
                        channels: channels,
                        articles: articles,
                        loaded: 1
                    });
                });
            }).catch(this.middleware.bind(this));
        }
    }, {
        key: 'middleware',
        value: function middleware(response) {
            var _this3 = this;

            var code = response.code,
                message = response.message;

            _toast2.default.hide();
            if ([0, -2].indexOf(code) == -1) {
                _toast2.default.fail(message, 1.5);
            }
            setTimeout(function () {
                _this3.setState({ loaded: 1 });
            });
        }
    }, {
        key: 'render',
        value: function render() {
            var _this4 = this;

            var _state = this.state,
                guides = _state.guides,
                entries = _state.entries,
                cards = _state.cards,
                channels = _state.channels,
                carousels = _state.carousels,
                articles = _state.articles,
                loaded = _state.loaded;

            var Guide = function Guide(guide, index) {
                var text = guide.button,
                    url = guide.url,
                    type = guide.type,
                    img = guide.img,
                    visible = guide.visible;

                var click = function click() {
                    if (type && _utils.platform.isApp) {
                        (0, _utils.hrefNative)(type);
                    } else {
                        url && (window.location.href = url);
                    }
                };
                if (_utils.platform.isIos && visible == 2) return;
                if (_utils.platform.isAndroid && visible == 1) return;
                return _react2.default.createElement(_flex2.default.Item, { key: index, onClick: click }, _react2.default.createElement('div', null, _react2.default.createElement('div', { className: 'icon', style: { backgroundImage: 'url(' + img + ')' } }), _react2.default.createElement('p', null, text)));
            };
            var Entrie = function Entrie(entrie, index) {
                var text = entrie.button,
                    content = entrie.content,
                    url = entrie.Jump_url,
                    type = entrie.type,
                    img = entrie.img_url,
                    visible = entrie.visible;

                var click = function click() {
                    if (type && _utils.platform.isApp) {
                        (0, _utils.hrefNative)(type);
                    } else {
                        url && (window.location.href = url);
                    }
                };
                if (_utils.platform.isIos && visible == 2) return;
                if (_utils.platform.isAndroid && visible == 1) return;
                return _react2.default.createElement('li', { key: index, onClick: click }, _react2.default.createElement('div', null, _react2.default.createElement('p', null, text), _react2.default.createElement('span', null, content)), _react2.default.createElement('div', { className: 'icon', style: { backgroundImage: 'url(' + img + ')' } }));
            };
            var carouselStyle = this.state.initialHeight ? { height: this.state.initialHeight } : {};
            return _react2.default.createElement('div', { className: (0, _classnames2.default)({ 'wrapper wrapper-mobile': true, loaded: loaded }) }, guides && _react2.default.createElement(_flex2.default, { className: 'guides' }, guides.map(Guide)), entries && _react2.default.createElement('ul', { className: 'entries' }, entries.map(Entrie)), carousels && carousels.length && !_utils.platform.isIos ? _react2.default.createElement('div', { className: 'activitys' }, carousels.length > 1 ? _react2.default.createElement(_carousel2.default, { selectedIndex: 1, autoplay: carousels && carousels.length > 1, infinite: true }, carousels.map(function (data, index) {
                return _react2.default.createElement('a', { key: index, href: data.action_url, style: carouselStyle }, data.title && _react2.default.createElement('h6', null, data.title), _react2.default.createElement('img', { src: data.img_url, onLoad: function onLoad() {
                        // fire window resize event to change height
                        window.dispatchEvent(new Event('resize'));
                        _this4.setState({
                            initialHeight: null
                        });
                    } }));
            })) : _react2.default.createElement('div', null, carousels.map(function (data, index) {
                return _react2.default.createElement('a', { key: index, href: data.action_url, style: carouselStyle }, data.title && _react2.default.createElement('h6', null, data.title), _react2.default.createElement('img', { src: data.img_url, onLoad: function onLoad() {
                        // fire window resize event to change height
                        window.dispatchEvent(new Event('resize'));
                        _this4.setState({
                            initialHeight: null
                        });
                    } }));
            }))) : '', channels && channels.data && _react2.default.createElement('div', null, subject({
                title: channels.header.title,
                subtitle: channels.header.content,
                link: channels.header.moreUrl
            }), channels.data && _react2.default.createElement(_list2.default, { className: 'diversion' }, channels.data.map(function (data, index) {
                return _react2.default.createElement(_list2.default.Item, { key: index, thumb: data.img_url, arrow: 'horizontal', onClick: function onClick() {
                        data.href && (window.location.href = data.href);
                    } }, data.title, _react2.default.createElement('div', { className: 'description' }, _react2.default.createElement(_list2.default.Item.Brief, null, data.sub_title)), _react2.default.createElement('div', { className: 'params' }, _react2.default.createElement(_list2.default.Item.Brief, null, _react2.default.createElement('p', null, '\u53C2\u8003', data.interest_type == 0 ? '年' : data.interest_type == 1 ? '月' : data.interest_type == 2 ? '日' : '/', '\u5229\u7387\uFF1A', _react2.default.createElement('span', null, data.loan_apr)), _react2.default.createElement('p', null, '\u6700\u9AD8\u989D\u5EA6\uFF1A', _react2.default.createElement('span', null, data.max_amount)))));
            }))), cards && cards.data && _react2.default.createElement('div', { className: 'banks' }, subject({
                title: cards.header.title,
                subtitle: cards.header.content,
                link: cards.header.moreUrl
            }), cards.data.map(function (data, index) {
                return _react2.default.createElement(_card2.default, { key: index, full: true }, _react2.default.createElement(_card2.default.Header, { title: data.title }), _react2.default.createElement(_card2.default.Body, null, _react2.default.createElement('div', { className: 'am-card-thumb', style: { backgroundImage: 'url(' + data.img + ')' } }), _react2.default.createElement('div', { className: 'details' }, _react2.default.createElement('p', null, '\u53D6\u73B0\u989D\u5EA6: ', data.quota), _react2.default.createElement('p', null, '\u514D\u606F\u671F: ', data.free), _react2.default.createElement('p', null, '\u53D1\u5361\u7EC4\u7EC7: ', data.organization), _react2.default.createElement('div', { className: 'button-apply', onClick: function onClick() {
                        data.url && (window.location.href = data.url);
                    } }, '\u7ACB\u5373\u7533\u8BF7'))));
            })), articles && _react2.default.createElement(_list2.default, { className: 'articles' }, articles.map(function (data, index) {
                return _react2.default.createElement(_list2.default.Item, { key: index, thumb: data.img_url, onClick: function onClick() {
                        // redirect.push(`/mobile/find/article/${data.id}`);
                        location.href = '/mobile/find/article/' + data.id;
                    } }, _react2.default.createElement('h6', null, data.title), _react2.default.createElement(_list2.default.Item.Brief, null, _react2.default.createElement('div', { className: 'preview' }, '+', data.see)));
            })));
        }
    }]);
    return Find;
}(_react.Component);

exports.default = Find;
;
module.exports = exports['default'];