{"version":3,"sources":["src\\js\\pages\\integral-mall\\details.js"],"names":["title","Item","Brief","lock","Details","props","state","name","image","price","loaded","description","document","params","location","query","id","then","response","data","disc_price","default_img","desc_img","status","setState","catch","middleware","bind","code","message","type","hide","indexOf","alert","undefined","text","onPress","FormData","append","loading","url","method","success","fail","push","setTimeout","content","index","__html","desc","priceElement","origin","sale","length","map","submit"],"mappings":"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","file":"details.js","sourceRoot":"E:/MyStudy/Redux/app_four","sourcesContent":["/* eslint-disable */\r\nimport React, {Component} from 'react';\r\nimport {Modal, List, Toast} from 'antd-mobile';\r\nimport {redirect, login, share} from 'utils';\r\nimport request from './request';\r\nimport 'scss/integral-mall/index.component.scss';\r\n\r\nlet title = '金币商城';\r\nlet Item = List.Item;\r\nlet Brief = Item.Brief;\r\nlet lock = true;\r\n\r\nexport default class Details extends Component{\r\n    constructor(props){\r\n        super(props);\r\n        this.state = {\r\n            name: '',\r\n            image: '',\r\n            price: 0,\r\n            loaded: 0,\r\n            description: []\r\n        };\r\n    }\r\n    componentDidMount(){\r\n        document.title = title;\r\n        let {query: params} = this.props.location;\r\n        request(`credit-gold/goods-detail?id=${params.id}`).then(response => {\r\n            let {id, name, price, disc_price, default_img: image, desc_img, description, status} = response.data;\r\n            this.setState({\r\n                id,\r\n                name,\r\n                image,\r\n                desc_img,\r\n                price,\r\n                disc_price,\r\n                loaded: 1,\r\n                description,\r\n                status\r\n            });\r\n        }).catch(this.middleware.bind(this));\r\n    }\r\n    middleware(response){\r\n        let {code, message} = response;\r\n        let type = 'info';\r\n\r\n        Toast.hide();\r\n        if([-1000, -1004].indexOf(code) >= 0){\r\n            type = 'fail';\r\n        }else if([-1003].indexOf(code) >= 0){\r\n            type = 'offline';\r\n        }else if(-1001 === code){\r\n            login();\r\n            return;\r\n        }\r\n        this.setState({\r\n            loaded: 1\r\n        });\r\n        Toast[type](message);\r\n    }\r\n    submit(){\r\n        Modal.alert(undefined, '确认兑换？', [{\r\n            text: '取消'\r\n        }, {\r\n            text: '兑换',\r\n            onPress: () => {\r\n                let {id, status} = this.state;\r\n                if(lock && status){\r\n                    lock = !lock;\r\n                    let params = new FormData();\r\n                        params.append('id', id);\r\n                    Toast.loading(undefined, 0);\r\n                    request({\r\n                        url: 'credit-gold/exchange',\r\n                        data: params,\r\n                        method: 'post'\r\n                    }).then(response => {\r\n                        Toast.success('兑换成功', () => {\r\n                            lock = !lock;\r\n                        });\r\n                    }).catch(response => {\r\n                        let {code, message} = response;\r\n                        if(code == -2102){\r\n                            Toast.fail(message, () => redirect.push('/signin'));\r\n                        }else{\r\n                            this.middleware.bind(this, response)();\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        }])\r\n    }\r\n    middleware(response){\r\n        let {code, message} = response;\r\n        let type = 'info';\r\n        if([-1015, -1016].indexOf(code) >= 0){\r\n            type = 'offline';\r\n        }else if(-1001 === code){\r\n            login();\r\n            return;\r\n        }else{\r\n            type = 'fail';\r\n        }\r\n        Toast[type](message, 1.5);\r\n        setTimeout(() => {\r\n            lock = true;\r\n        }, 1500);\r\n    }\r\n    render(){\r\n        let {name, image, desc_img, price, disc_price, loaded, description, status} = this.state;\r\n        let content = (data, index) => {\r\n            return (\r\n                <li key={index}>\r\n                    <h5>{data.title}</h5>\r\n                    <div className='details' dangerouslySetInnerHTML={{__html: data.desc}}></div>\r\n                </li>\r\n            );\r\n        };\r\n        let priceElement = (origin, sale) => {\r\n            return (\r\n                <div className='price'>\r\n                    {(!!sale && sale < price) && (<p className='sale'><span>{price}</span></p>)}\r\n                    <p className='origin'><span>{(!!sale && sale < price) ? sale : price}</span></p>\r\n                </div>\r\n            );\r\n        }\r\n        return (\r\n            <div className={`wrapper wrapper-integral-mall-old toolbar-through ${loaded ? 'loaded' : ''}`}>\r\n                <div className='carousel'>\r\n                    <a className='slider-link' href='javascript:;'>\r\n                        <img src={desc_img}/>\r\n                    </a>\r\n                </div>\r\n                <List className='main'>\r\n                    <Item\r\n                    multipleLine\r\n                    extra={priceElement(price, disc_price)}>\r\n                        {name}\r\n                        <Brief>\r\n                            <span className={`${status ? '' : 'disabled'}`}>\r\n                                {status ? '抢购中' : '已抢完'}\r\n                            </span>\r\n                        </Brief>\r\n                    </Item>\r\n                </List>\r\n                {description.length && (\r\n                    <ul className='description'>\r\n                        {description.map((desc, index) => content(desc, index))}\r\n                    </ul>\r\n                )}\r\n                <div className='toolbar'>\r\n                    <div className={`button ${status ? '' : 'disabled'}`} onClick={this.submit.bind(this)}>\r\n                        {status ? '马上兑换' : '抢光啦'}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n};"]}