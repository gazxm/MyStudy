'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = undefined;

var _css = require('antd-mobile/lib/segmented-control/style/css');

var _segmentedControl = require('antd-mobile/lib/segmented-control');

var _segmentedControl2 = _interopRequireDefault(_segmentedControl);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _css2 = require('antd-mobile/lib/modal/style/css');

var _modal = require('antd-mobile/lib/modal');

var _modal2 = _interopRequireDefault(_modal);

var _css3 = require('antd-mobile/lib/list/style/css');

var _list = require('antd-mobile/lib/list');

var _list2 = _interopRequireDefault(_list);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _utils = require('utils');

var _moment = require('moment');

var _moment2 = _interopRequireDefault(_moment);

var _request = require('./request');

var _request2 = _interopRequireDefault(_request);

require('scss/cash-bonus/index.component.scss');

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var title = '现金红包'; /* eslint-disable */

var Item = _list2.default.Item;
var Brief = Item.Brief;
var defaultIcon = require('../../../assets/img/cash-bonus/icon.png');
var alert = _modal2.default.alert;

var CashBonus = function (_Component) {
    (0, _inherits3.default)(CashBonus, _Component);

    function CashBonus(props) {
        (0, _classCallCheck3.default)(this, CashBonus);

        var _this = (0, _possibleConstructorReturn3.default)(this, (CashBonus.__proto__ || (0, _getPrototypeOf2.default)(CashBonus)).call(this, props));

        _this.state = {
            money: 0,
            total: 0,
            segments: ['当前奖金', '提现历史'],
            segmentIndex: 0,
            items: [],
            cashs: [],
            loaded: 0
        };
        return _this;
    }

    (0, _createClass3.default)(CashBonus, [{
        key: 'componentDidMount',
        value: function componentDidMount() {
            var _this2 = this;

            document.title = title;
            (0, _request2.default)('user-account/index').then(function (response) {
                var _response$data = response.data,
                    money = _response$data.balance,
                    total = _response$data.total,
                    items = _response$data.logs,
                    cashs = _response$data.cash,
                    is_card = _response$data.is_card,
                    is_pwd = _response$data.is_pwd,
                    is_date_limit = _response$data.is_date_limit,
                    is_overdue = _response$data.is_overdue;

                _this2.setState({
                    money: +money,
                    total: total,
                    items: items,
                    cashs: cashs,
                    is_card: is_card,
                    is_pwd: is_pwd,
                    loaded: 1
                });
            }).catch(this.middleware.bind(this));
        }
    }, {
        key: 'middleware',
        value: function middleware(response) {
            var code = response.code,
                message = response.message;

            this.setState({
                loaded: 1
            });
            if (-1001 === code) {
                (0, _utils.login)();
                return;
            } else {
                Toast.fail(message, 1.5);
            }
        }
    }, {
        key: 'segment',
        value: function segment(value) {
            var segments = this.state.segments;

            var index = segments.indexOf(value);
            if (index >= 0) {
                this.setState({
                    segmentIndex: index
                });
            }
        }
    }, {
        key: 'isActive',
        value: function isActive(index) {
            var segmentIndex = this.state.segmentIndex;

            return index === segmentIndex ? 'active' : '';
        }
    }, {
        key: 'withdrawal',
        value: function withdrawal() {
            var _state = this.state,
                money = _state.money,
                is_card = _state.is_card,
                is_pwd = _state.is_pwd,
                is_date_limit = _state.is_date_limit,
                is_overdue = _state.is_overdue;

            var message = function message(_message) {
                return _react2.default.createElement('p', { className: 'tips', dangerouslySetInnerHTML: { __html: _message } });
            };
            if (is_card == 0) {
                alert(undefined, message('请先绑定银行卡再提现'), [{
                    text: '取消'
                }, {
                    text: '去绑定',
                    onPress: function onPress() {
                        // todo 跳转到原生绑定银行卡
                        window.location = (0, _utils.resolveUrl)('http://m.xianjincard.com/loan/card-list');
                    }
                }]);
                return;
            } else if (is_pwd == 0) {
                alert(undefined, message('请先设置交易密码再提现'), [{
                    text: '取消'
                }, {
                    text: '去设置',
                    onPress: function onPress() {
                        // todo 跳转到原生设置交易密码
                        window.location = (0, _utils.resolveUrl)('http://h5.xianjincard.com/mobile/#/my/paypassword?state=' + encodeURIComponent(window.location.href));
                    }
                }]);
                return;
            } else if (is_date_limit == 0) {
                alert(undefined, message('本周一次提现机会已经用完咯<br/>您下周再来吧'), [{
                    text: '确定'
                }]);
                return;
            } else if (is_overdue == 0) {
                alert(undefined, message('您目前有订单处于预期中，请先还款后再提现'), [{
                    text: '确定'
                }]);
                return;
            } else if (money < 30) {
                alert(undefined, message('您的提现额度不足30元<br/>不能提现'), [{
                    text: '确定'
                }]);
                return;
            } else {
                window.location.href = 'cash-bonus/withdrawal?money=' + money;
            }
        }
    }, {
        key: 'render',
        value: function render() {
            var _state2 = this.state,
                money = _state2.money,
                total = _state2.total,
                segments = _state2.segments,
                segmentIndex = _state2.segmentIndex,
                items = _state2.items,
                cashs = _state2.cashs,
                loaded = _state2.loaded;

            var source = function source(data, index) {
                var title = data.title,
                    type = data.type,
                    money = data.amount,
                    _data$icon = data.icon,
                    icon = _data$icon === undefined ? defaultIcon : _data$icon,
                    created_at = data.created_at;

                var date = _moment2.default.unix(created_at).format('YYYY-MM-DD HH:mm:ss');
                return _react2.default.createElement(Item, {
                    key: index,
                    multipleLine: true,
                    extra: '+' + money,
                    thumb: icon }, title, _react2.default.createElement(Brief, null, date));
            };
            var history = function history(data, index) {
                var title = data.title,
                    type = data.type,
                    money = data.amount,
                    created_at = data.created_at;

                var date = _moment2.default.unix(created_at).format('YYYY-MM-DD HH:mm:ss');
                return _react2.default.createElement(Item, {
                    key: index,
                    multipleLine: true,
                    extra: '+' + money }, title, _react2.default.createElement(Brief, null, date));
            };
            return _react2.default.createElement('div', { className: 'wrapper wrapper-cash-bonus ' + (loaded ? 'loaded' : '') }, _react2.default.createElement(_segmentedControl2.default, {
                className: 'segment',
                onValueChange: this.segment.bind(this),
                selectedIndex: segmentIndex,
                values: segments }), _react2.default.createElement('div', { className: 'segment-content' }, _react2.default.createElement('div', { className: 'home ' + this.isActive.bind(this, 0)() }, _react2.default.createElement('div', { className: 'main' }, _react2.default.createElement('div', null, '\u5F53\u524D\u53EF\u63D0\u73B0\u91D1\u989D(\u5143)', _react2.default.createElement('div', { className: 'money' }, money), _react2.default.createElement('div', { className: 'withdrawal', onClick: this.withdrawal.bind(this) }, '\u7ACB\u5373\u63D0\u73B0'), _react2.default.createElement('div', { className: 'total' }, '\u5386\u53F2\u83B7\u5F97\u91D1\u989D\uFF1A', total, '\u5143'), _react2.default.createElement('div', { className: 'help', onClick: function onClick() {
                    window.location.href = '/cash-bonus/instruction';
                } }, '\u4EC0\u4E48\u662F\u73B0\u91D1\u7EA2\u5305\uFF1F'))), _react2.default.createElement(_list2.default, { renderHeader: function renderHeader() {
                    return '奖励来源';
                } }, _react2.default.createElement('div', { className: 'content' }, items.length ? items.map(function (item, index) {
                return source(item, index);
            }) : _react2.default.createElement('div', { className: 'empty' }, '\u6682\u65E0\u6570\u636E'))), _react2.default.createElement(_list2.default, { renderHeader: function renderHeader() {
                    return '提现说明';
                } }, _react2.default.createElement('ul', { className: 'description' }, _react2.default.createElement('li', null, '\u6BCF\u4E2A\u5468\u53EF\u7533\u8BF7\u4E00\u6B21\u73B0\u91D1\u63D0\u73B0\uFF1B'), _react2.default.createElement('li', null, '\u7D2F\u8BA1\u6EE130\u5143\u624D\u53EF\u4EE5\u63D0\u73B0\uFF0C\u4E14\u53EA\u80FD\u5168\u989D\u63D0\u53D6\uFF1B'), _react2.default.createElement('li', null, '\u5904\u4E8E\u903E\u671F\u72B6\u6001\u4E2D\u7684\u7528\u6237\u9700\u5148\u8FD8\u6B3E\u624D\u53EF\u4EE5\u63D0\u73B0'), _react2.default.createElement('li', null, '\u7533\u8BF7\u6210\u529F\u540E\uFF0C\u5956\u91D1\u5C06\u57283\u4E2A\u5DE5\u4F5C\u65E5\u5185\u53D1\u653E\u5230\u60A8\u7ED1\u5B9A\u7684\u94F6\u884C\u5361\u4E0A;'), _react2.default.createElement('li', null, '\u5982\u9047\u6CD5\u5B9A\u8282\u5047\u65E5\uFF0C\u63D0\u73B0\u8FDB\u5EA6\u987A\u5EF6\uFF1B'), _react2.default.createElement('li', null, '\u5982\u6709\u95EE\u9898\u8BF7\u62E8\u6253\u5BA2\u670D\u70ED\u7EBF', _react2.default.createElement('span', null, '400\uFF0D681\uFF0D2016'))))), _react2.default.createElement('div', { className: 'history ' + this.isActive.bind(this, 1)() }, _react2.default.createElement(_list2.default, null, _react2.default.createElement('div', { className: 'content' }, cashs.length ? cashs.map(function (cash, index) {
                return history(cash, index);
            }) : _react2.default.createElement('div', { className: 'empty' }, '\u6682\u65E0\u6570\u636E'))))));
        }
    }]);
    return CashBonus;
}(_react.Component);

exports.default = CashBonus;
;
module.exports = exports['default'];