{"version":3,"sources":["src\\js\\pages\\mobile\\misc\\Coupon.js"],"names":["message","Coupon","props","dataSource","DataSource","rowHasChanged","row1","row2","isNotData","state","cloneWithRows","refreshing","document","title","then","result","data","code","info","item","length","setState","catch","error","console","log","fetchData","rowData","parseInt","status","use_type","is_check_loan","push","up_term","up_amount","coupon_id","createFooter","row","sectionID","rowID","amount","itemClass","onClick","bind","coupon_name","loan_amount","loan_term","time","height","documentElement","clientHeight","margin","scrollbars","window","lib","flexible","dpr","onRefresh","Component"],"mappings":"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","file":"Coupon.js","sourceRoot":"E:/MyStudy/Redux/app_four","sourcesContent":["import React from 'react'\r\nimport {Link} from 'react-router'\r\nimport {Icon, RefreshControl, ListView} from 'antd-mobile'\r\nimport {get, redirect} from 'utils'\r\nimport Toast from 'components/Toast'\r\nimport 'scss/mobile/coupon.component.scss'\r\nimport classNames from 'classnames'\r\n// function testable (param) {\r\n//   return function (clazz) {\r\n//     clazz.defaultProps = Object.assign({}, clazz.defaultProps || {}, param)\r\n//     return clazz\r\n//   }\r\n// }\r\n\r\n// is_check_loan 1, 2, 3\r\nconst message = ['未完成基础认证', '你有处于审核状态下的借款，无法申请新的借款', '你有未还款的借款，请先还完才能继续申请借款']\r\n\r\nexport default class Coupon extends React.Component {\r\n  constructor (props) {\r\n    super(props)\r\n    const dataSource = new ListView.DataSource({\r\n      rowHasChanged: (row1, row2) => row1 !== row2\r\n    })\r\n//    console.log(this.props)\r\n    this.isNotData = false\r\n    this.state = {\r\n      dataSource: dataSource.cloneWithRows([]),\r\n      refreshing: true\r\n    }\r\n  }\r\n  componentDidMount () {\r\n    document.title = '现金券'\r\n    // this.setState({refreshing: true})\r\n  }\r\n  fetchData () {\r\n    get('http://credit.xianjincard.com/v2/coupon/get-my-coupon').then((result) => {\r\n      if (result.data.code !== 0) {\r\n        Toast.info(result.data.message, 2)\r\n        return\r\n      }\r\n      return result.data.data\r\n    }).then((data) => {\r\n      const item = data.item.length > 0 ? data.item : [{isNotData: true}]\r\n      this.setState({\r\n        dataSource: this.state.dataSource.cloneWithRows(item),\r\n        refreshing: false\r\n      })\r\n    }).catch((error) => { console.log(error) })\r\n  }\r\n  onRefresh () {\r\n    this.setState({ refreshing: true })\r\n    this.fetchData()\r\n  }\r\n  onClick (rowData) {\r\n    if (parseInt(rowData.status) === 2) {\r\n      return\r\n    }\r\n    if (parseInt(rowData.use_type) === 3) {\r\n      if (rowData.is_check_loan > 5) {\r\n        Toast.info(message[rowData.is_check_loan - 1], 2)\r\n        return\r\n      }\r\n      redirect.push(`/mobile/loan/${1}/${rowData.up_term}/${rowData.up_amount}/${rowData.coupon_id}`)\r\n    }\r\n  }\r\n  createFooter () {\r\n    return <Link to=\"/misc/instruction/coupon\">使用说明</Link>\r\n  }\r\n  createEmpty () {\r\n    if (this.state.isNotData) {\r\n      return (\r\n        <div class=\"result\">\r\n          <img src=\"/assets/img/mobile/misc/icon-1.png\"/>\r\n          <p>你没有任何抵扣券记录哦~</p>\r\n          {this.createFooter()}\r\n        </div>\r\n      )\r\n    }\r\n  }\r\n  render () {\r\n    // status 2 已过期 1 已使用\r\n    const row = (rowData, sectionID, rowID) => {\r\n      if (rowData.isNotData) {\r\n        return (\r\n          <div class=\"result\">\r\n            <img src=\"/assets/img/mobile/misc/icon-1.png\"/>\r\n            <p>你没有任何抵扣券记录哦~</p>\r\n          </div>\r\n        )\r\n      }\r\n      const title = parseInt(rowData.use_type) === 2 ? <h3>{rowData.title}</h3> : <h4><i>￥</i>{rowData.amount}</h4>\r\n      const itemClass = classNames({'coupon-item': true, 'expired': (parseInt(rowData.status) === 2), 'used': (parseInt(rowData.status) === 1)})\r\n      return (\r\n        <div className={itemClass} key={rowID} onClick={this.onClick.bind(this, rowData)}>\r\n          <span>{title}</span>\r\n          <span class=\"active\">\r\n            <div>\r\n              <h3>{rowData.coupon_name}</h3>\r\n              <p>{rowData.loan_amount}</p>\r\n              <p>{rowData.loan_term}</p>\r\n              <p>{rowData.time}</p>\r\n              <div>{parseInt(rowData.status) !== 2 && parseInt(rowData.use_type) === 3 && <i>点击使用</i>}</div>\r\n            </div>\r\n          </span>\r\n        </div>\r\n      )\r\n    }\r\n\r\n    return (\r\n      <div class=\"coupon xjk-refresh\">\r\n      <ListView\r\n        dataSource={this.state.dataSource}\r\n        renderRow={row}\r\n        initialListSize={5}\r\n        pageSize={5}\r\n        scrollRenderAheadDistance={200}\r\n        scrollEventThrottle={20}\r\n        style={{\r\n          height: document.documentElement.clientHeight,\r\n          margin: '0.1rem 0'\r\n        }}\r\n        scrollerOptions={{ scrollbars: true }}\r\n        renderFooter={this.createFooter}\r\n        refreshControl={\r\n            <RefreshControl\r\n                refreshing={this.state.refreshing}\r\n                icon={[\r\n                  <div key=\"0\" className=\"am-refresh-control-pull\">\r\n                        <Icon type=\"arrow-down\"/><span>科技让金融更简单</span>\r\n                      </div>,\r\n                  <div key=\"1\" className=\"am-refresh-control-release\">\r\n                    <Icon type=\"arrow-up\"/><span>科技让金融更简单</span>\r\n                  </div>\r\n                ]}\r\n                  distanceToRefresh={40 * window.lib.flexible.dpr}\r\n                  onRefresh={this.onRefresh.bind(this)}/>\r\n            }/>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n"]}