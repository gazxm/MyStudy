{"version":3,"sources":["src\\js\\pages\\mobile\\repayment\\part.js"],"names":["title","Item","RETRY_TEXT","timer","Part","props","state","fee","money","value","lock","loaded","loading","query","interceptors","response","use","code","message","reject","resolve","error","document","id","location","fail","goBack","then","data","item","late_fee","remian_time","repayment_amount","repayment_date","last_amount","setps","remain_amount","service","remain_service","tips","remain_tip","setState","parseFloat","catch","middleware","bind","setFieldsValue","form","hide","modal","querySelector","alert","text","onPress","login","post","service_fee","principal","total_money","success","push","length","window","href","show","remove","undefined","password","setInterval","clearInterval","submit","index","indexOf","visible","onChange","__html","contextTypes","router","PropTypes","object","isRequired"],"mappings":"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","file":"part.js","sourceRoot":"E:/MyStudy/Redux/app_four","sourcesContent":["/* eslint-disable */\r\nimport React, {Component, createClass} from 'react';\r\nimport {Modal, NoticeBar, InputItem, List, Stepper, Button, Toast} from 'antd-mobile';\r\nimport {createForm} from 'rc-form';\r\nimport classnames from 'classnames';\r\nimport 'scss/mobile/repayment/part.component.scss';\r\nimport request from 'common/request';\r\nimport {resolveUrl as url, redirect, hrefNative as native, platform} from 'utils';\r\nimport Password from 'components/Password';\r\n\r\nconst title = '部分还款';\r\nconst Item = List.Item;\r\nconst RETRY_TEXT = '系统繁忙，请稍后重试';\r\n\r\nlet timer;\r\n\r\nclass Part extends Component{\r\n\tstatic contextTypes = {\r\n        router: React.PropTypes.object.isRequired\r\n    }\r\n    state = {\r\n        fee: 0,\r\n        money: 0,\r\n        value: 0,\r\n    \t// LOCK\r\n        lock: 1,\r\n        // 数据加载完毕\r\n        loaded: 0,\r\n        // request loading\r\n        loading: 0,\r\n        query: 0\r\n    }\r\n    constructor(props){\r\n        super(props);\r\n        request.interceptors.response.use(response => {\r\n            let {code, message} = response;\r\n            if(code != 0){\r\n                return Promise.reject(response);\r\n            }\r\n            return Promise.resolve(response);\r\n        }, error => {\r\n            return Promise.reject(error);\r\n        });\r\n    }\r\n    componentDidMount(){\r\n        document.title = title;\r\n        let {id} = this.props.location.query;\r\n        if(!id){\r\n            Toast.fail('订单号为空', () => {\r\n                redirect.goBack();\r\n            })\r\n            return;\r\n        }\r\n        request(`credit-pay/loan-partial?id=${id}`).then(response => {\r\n            let {item: {title, late_fee, remian_time, repayment_amount, repayment_date, last_amount, remain_amount: setps, remain_service: service, remain_tip: tips}} = response.data;\r\n            remian_time = 0;\r\n            this.setState({\r\n                title,\r\n                remian_time,\r\n                late_fee,\r\n                repayment_amount,\r\n                repayment_date,\r\n                last_amount,\r\n                setps,\r\n                service,\r\n                tips,\r\n                fee: service[0],\r\n                value: (setps[0] - 0),\r\n                money: (setps[0] - 0) + (service[0] - 0) + parseFloat(late_fee, 10),\r\n                loaded: 1\r\n            });\r\n        }).catch(this.middleware.bind(this));\r\n    }\r\n    middleware(response){\r\n        let {setFieldsValue} = this.props.form;\r\n        let {code, message = RETRY_TEXT} = response;\r\n        Toast.hide();\r\n        if(code == -2){\r\n            let modal = document.querySelector('.am-modal');\r\n            if(!modal){\r\n                Modal.alert('提 示', message, [{\r\n                    text: '确 定',\r\n                    onPress: login\r\n                }])\r\n            }\r\n        }else{\r\n            Toast.fail(message, () => {\r\n                this.setState && this.setState({lock: 1, loaded: 1});\r\n                redirect.goBack();\r\n            });\r\n            this.setState({loading: 0});\r\n        }\r\n    }\r\n    query(){\r\n        let {id} = this.props.location.query;\r\n        let {fee, value, money, setps, remian_time, query} = this.state;\r\n        this.setState({query: 1});\r\n        request.post(`credit-pay/partial-apply?id=${id}`, {\r\n            // 服务费\r\n            service_fee: fee,\r\n            //  所选金额\r\n            principal: value,\r\n            // 合计金额\r\n            total_money: money\r\n        }).then(response => {\r\n            let {message} = response;\r\n            Toast.success(message || '操作成功', () => {\r\n                redirect.push(`/mobile/repayment/result/${id}`);\r\n            });\r\n        }).catch(this.middleware.bind(this));\r\n    }\r\n    submit(){\r\n        let {id} = this.props.location.query;\r\n        let {fee, value, money, setps, remian_time} = this.state;\r\n        if(remian_time || (value == setps[setps.length - 1])){\r\n            window.location.href = url(`http://m.xianjincard.com/loan/loan-repayment-type?id=${id}`);\r\n            return;\r\n        }\r\n        Password.show(password => {\r\n            Password.remove();\r\n            Toast.loading(undefined, 0);\r\n            request.post('http://192.168.39.214/kdkj/mobile/web/user/check-pay-pwd-post', {\r\n                password\r\n            }).then(response => {\r\n                Password.remove();\r\n                timer = setInterval(() => {\r\n                    if(this.state.query){\r\n                        timer && clearInterval(timer);\r\n                    }else{\r\n                        this.query.bind(this)();\r\n                    }\r\n                }, 1000)\r\n            }).catch(response => {\r\n                let {message} = response;\r\n                Toast.hide();\r\n                this.submit.bind(this)();\r\n                Password.error(message);\r\n            });\r\n        });\r\n    }\r\n    onChange(value){\r\n        let {setps, service, late_fee} = this.state;\r\n        let index = setps.indexOf(value + '');\r\n        this.setState({value});\r\n        if(index >= 0){\r\n            this.setState({\r\n                fee: service[index] || 0,\r\n                money: value + (service[index] - 0) + parseFloat(late_fee, 10)\r\n            });\r\n        }\r\n    }\r\n    render(){\r\n    \tlet {fee, money, tips, late_fee, remian_time, repayment_amount, repayment_date, last_amount, title, setps, value, visible, lock, loaded, loading} = this.state;\r\n    \treturn (\r\n    \t\t<div className={classnames({'wrapper wrapper-mobile wrapper-repayment-part': true, loaded})}>\r\n    \t\t\t{title && <NoticeBar className='notice'>{title}</NoticeBar>}\r\n    \t\t\t{(remian_time == 0) ? \r\n                    <List>\r\n                        <Item extra={setps ? <Stepper defaultValue={setps[0] - 0} min={setps[0] - 0} max={setps[setps.length - 1] - 0} step={100} onChange={this.onChange.bind(this)} showNumber/> : ''}>\r\n                            首次还款\r\n                        </Item>\r\n                        <Item extra={`${late_fee}元`}>逾期费</Item>\r\n                        <Item extra={`${fee}元`}>手续费</Item>\r\n                        <Item extra={<div className='money'>{money}元</div>}>总金额</Item>\r\n                    </List>\r\n                : \r\n                    <List>\r\n                        <Item extra={repayment_date}>首次还款日</Item>\r\n                        <Item extra={`${repayment_amount}元`}>已还款金额</Item>\r\n                        <Item extra={<div className='money'>{last_amount}元</div>}>剩余待还款</Item>\r\n                    </List>\r\n                }\r\n                {(tips && !remian_time) && <div className='tips-repayment' dangerouslySetInnerHTML={{__html: `<div>${tips}</div>`}}/>}\r\n\t\t\t\t\r\n\t\t\t\t<div className='tips'>\r\n\t\t\t\t\t温馨提示：部分还款仅<span>支持银行卡还款，不支持支付宝还款</span>。\r\n\t\t\t\t</div>\r\n    \t\t\t<div className='footer'>\r\n\t\t\t\t\t<Button\r\n\t\t            type='primary'\r\n\t\t            disabled={!lock || loading}\r\n\t\t            loading={loading}\r\n\t\t            className={classnames({\r\n\t\t                'button-submit': true,\r\n\t\t                'button-round': true,\r\n\t\t                'button-loading': !loaded,\r\n\t\t                // 'button-disabled': disabled\r\n\t\t            })}\r\n\t\t            onClick={this.submit.bind(this)}>立即还款</Button>\r\n                    <div className='instruction'>\r\n                        <span onClick={() => this.setState({visible: 1})}>查看规则说明</span>\r\n                    </div>\r\n    \t\t\t</div>\r\n    \t\t\t<Modal className='repayment-part-modal-instruction' title='部分还款规则说明' onClose={() => this.setState({visible: 0})} visible={visible} transparent>\r\n    \t\t\t\t<dl>\r\n    \t\t\t\t\t<dt>1、规则说明</dt>\r\n    \t\t\t\t\t<dd>部分还款，可以分2次完成还款，首次还款金额不低于应还款金额的30%。您将会享有3天的宽限期，在3天内完成全部还款，不会进入第三方催收程序，也不会影响您的信用。</dd>\r\n    \t\t\t\t</dl>\r\n    \t\t\t\t<dl>\r\n    \t\t\t\t\t<dt>2、相关费用</dt>\r\n    \t\t\t\t\t<dd>申请部分还款，需要收取一定的手续费。首次还款成功后，已还款金额将不再收逾期管理费，平台会对剩余未还金额收取1%/天的逾期管理费。部分还款仅支持银行卡还款，不支持支付宝还款。</dd>\r\n    \t\t\t\t</dl>\r\n    \t\t\t</Modal>\r\n    \t\t</div>\r\n    \t)\r\n    }\r\n}\r\n\r\nexport default createForm()(Part);"]}