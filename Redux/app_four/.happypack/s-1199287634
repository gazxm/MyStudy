'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _utils = require('utils');

var _Toast = require('components/Toast');

var _Toast2 = _interopRequireDefault(_Toast);

require('scss/mobile/repayment.result.component.scss');

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

var btnText = ['完成', '支付宝还款', '重新支付', '知道了'];
// import {Button} from 'antd-mobile'

var text = ['还款成功', '还款失败', '还款等待'];
var clsName = ['success', 'fail', ''];

var Result = function (_React$Component) {
  (0, _inherits3.default)(Result, _React$Component);

  function Result(props) {
    (0, _classCallCheck3.default)(this, Result);

    var _this = (0, _possibleConstructorReturn3.default)(this, (Result.__proto__ || (0, _getPrototypeOf2.default)(Result)).call(this, props));

    (0, _utils.navLeftButton)(function () {
      window.location.href = this.state.item.url;
    });
    _this.state = { item: null };
    return _this;
  }

  (0, _createClass3.default)(Result, [{
    key: 'componentDidMount',
    value: function componentDidMount() {
      document.title = '还款结果';
      this.fetch(this.props.params);
    }
  }, {
    key: 'fetch',
    value: function fetch(params) {
      var _this2 = this;

      _Toast2.default.loading('加载中...');
      var cardTag = this.props.location.query.card_tag;

      cardTag && (params.card_tag = cardTag);
      (0, _utils.get)('http://credit.xianjincard.com/credit-pay/pay-result-code', params).then(function (result) {
        _Toast2.default.hide();
        return result.data;
      }).then(function (data) {
        if (data.code !== 0) {
          _Toast2.default.info(data.message, 2);
          return;
        }
        _this2.setState({ item: data.data.item });
      });
    }
  }, {
    key: 'polling',
    value: function polling(code) {
      var _this3 = this;

      if (code === 2) {
        setTimeout(function () {
          _this3.fetch(_this3.props.params);
        }, 5000);
      }
    }
  }, {
    key: 'render',
    value: function render() {
      var item = this.state.item;

      if (item === null) {
        return null;
      }
      this.polling(item.trade_code);
      return _react2.default.createElement('div', { className: 'repayment-result' }, _react2.default.createElement('i', { className: clsName[item.trade_code] }), _react2.default.createElement('h1', null, text[item.trade_code]), _react2.default.createElement('p', null, item.message), _react2.default.createElement('a', { className: 'btn', href: item.button_action }, btnText[item.button]), item.button_repay && _react2.default.createElement('p', null, '\u94F6\u884C\u5361\u65E0\u6CD5\u8FD8\u6B3E\uFF1F\u70B9\u6B64', _react2.default.createElement('a', { href: item.button_repay }, '\u8BD5\u8BD5\u652F\u4ED8\u5B9D\u8FD8\u6B3E')));
    }
  }]);
  return Result;
}(_react2.default.Component);

exports.default = Result;
module.exports = exports['default'];