'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _css = require('antd-mobile/lib/white-space/style/css');

var _whiteSpace = require('antd-mobile/lib/white-space');

var _whiteSpace2 = _interopRequireDefault(_whiteSpace);

var _css2 = require('antd-mobile/lib/refresh-control/style/css');

var _refreshControl = require('antd-mobile/lib/refresh-control');

var _refreshControl2 = _interopRequireDefault(_refreshControl);

var _css3 = require('antd-mobile/lib/date-picker/style/css');

var _datePicker = require('antd-mobile/lib/date-picker');

var _datePicker2 = _interopRequireDefault(_datePicker);

var _css4 = require('antd-mobile/lib/list-view/style/css');

var _listView = require('antd-mobile/lib/list-view');

var _listView2 = _interopRequireDefault(_listView);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _css5 = require('antd-mobile/lib/tabs/style/css');

var _tabs = require('antd-mobile/lib/tabs');

var _tabs2 = _interopRequireDefault(_tabs);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _utils = require('utils');

var _Toast = require('../../components/Toast');

var _Toast2 = _interopRequireDefault(_Toast);

require('scss/components/employer.component.scss');

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

var dataSourceListOne = [];
var dataSourceListTwo = [];
var locked = 1;
var lockedTwo = 1;

var TabPane = _tabs2.default.TabPane;

var CustomChildren = function CustomChildren(props) {
  return _react2.default.createElement('div', { onClick: props.onClick, className: 'date-custom' }, props.children, _react2.default.createElement('span', { className: 'date-span' }, props.extra));
};

var Thelist = function (_React$Component) {
  (0, _inherits3.default)(Thelist, _React$Component);

  function Thelist(props) {
    (0, _classCallCheck3.default)(this, Thelist);

    var _this = (0, _possibleConstructorReturn3.default)(this, (Thelist.__proto__ || (0, _getPrototypeOf2.default)(Thelist)).call(this, props));

    var dataSource = new _listView2.default.DataSource({
      rowHasChanged: function rowHasChanged(row1, row2) {
        return row1 !== row2;
      }
    });
    _this.ofset = 30;
    _this.pageNow = 1;
    _this.pageNowTwo = 1;
    _this.state = {
      startDate: '',
      endDate: '',
      startDateTwo: '',
      endDateTwo: '',
      dataSource: dataSource,
      dataSourceTwo: dataSource,
      refreshing: false,
      refreshingTwo: false
    };
    return _this;
  }

  (0, _createClass3.default)(Thelist, [{
    key: 'componentDidMount',
    value: function componentDidMount() {
      var _this2 = this;

      document.title = '资金方查询';
      var params = {
        ofset: this.ofset
      };
      _Toast2.default.loading('');
      (0, _utils.post)('http://credit.xianjincard.com/credit-fund/fund-salculate', params).then(function (data) {
        return data.data;
      }).then(function (data) {
        _this2.setState({
          dataSource: _this2.state.dataSource.cloneWithRows([]),
          dataSourceTwo: _this2.state.dataSourceTwo.cloneWithRows([])
        });
        if (data.code === 103) {
          _Toast2.default.hide();
          _Toast2.default.info('请先登录哦', 2);
          _utils.redirect.push('/employer/login');
          return;
        }
        if (data.code !== 1) {
          _Toast2.default.hide();
          _Toast2.default.info('' + data.message, 2);
          return;
        }
        (0, _utils.post)('http://credit.xianjincard.com/credit-fund/fund-order-list', params).then(function (data) {
          return data.data;
        }).then(function (data2) {
          _Toast2.default.hide();
          if (data2.code === 103) {
            _Toast2.default.info('请先登录哦', 2);
            _utils.redirect.push('/employer/login');
            return;
          }
          if (data2.code !== 1) {
            _Toast2.default.info('' + data2.message, 2);
            return;
          }
          _this2.setState({
            dataSource: _this2.state.dataSource.cloneWithRows(data.data.res_list),
            dataSourceTwo: _this2.state.dataSourceTwo.cloneWithRows(data2.data.res_list)
          });
          dataSourceListOne = data.data.res_list;
          dataSourceListTwo = data2.data.res_list;
        });
      });
    }
  }, {
    key: 'onRefresh',
    value: function onRefresh() {
      var _this3 = this;

      this.setState({ refreshing: true });
      var params = {
        ofset: this.ofset
      };
      if (this.state.startDate && this.state.endDate) {
        params = {
          ofset: this.ofset,
          begintime: this.state.startDate.format('YYYY-MM-DD'),
          endtime: this.state.endDate.format('YYYY-MM-DD')
        };
      }
      (0, _utils.post)('http://credit.xianjincard.com/credit-fund/fund-salculate', params).then(function (data) {
        return data.data;
      }).then(function (data) {
        if (data.code === 103) {
          _Toast2.default.info('请先登录哦', 2);
          _utils.redirect.push('/employer/login');
          return;
        }
        if (data.code === -3) {
          _this3.setState({
            refreshing: false
          });
          _Toast2.default.info('选择的起始时间应小于结束时间哦', 2);
          return;
        }
        if (data.code !== 1) {
          _this3.setState({
            refreshing: false
          });
          _Toast2.default.info('' + data.message, 2);
          return;
        }
        _this3.setState({
          dataSource: _this3.state.dataSource.cloneWithRows(data.data.res_list),
          refreshing: false
        });
        dataSourceListOne = data.data.res_list;
        if (dataSourceListOne.length === 0) {
          _Toast2.default.info('没有数据', 2);
        }
        _this3.pageNow = 1;
        locked = 1;
      });
    }
  }, {
    key: 'onRefreshTwo',
    value: function onRefreshTwo() {
      var _this4 = this;

      this.setState({ refreshingTwo: true });
      var params = {
        ofset: this.ofset
      };
      if (this.state.startDateTwo && this.state.endDateTwo) {
        params = {
          ofset: this.ofset,
          begintime: this.state.startDateTwo.format('YYYY-MM-DD'),
          endtime: this.state.endDateTwo.format('YYYY-MM-DD')
        };
      }
      (0, _utils.post)('http://credit.xianjincard.com/credit-fund/fund-order-list', params).then(function (data) {
        return data.data;
      }).then(function (data) {
        if (data.code === 103) {
          _Toast2.default.info('请先登录哦', 2);
          _utils.redirect.push('/employer/login');
          return;
        }
        if (data.code === -3) {
          _this4.setState({
            refreshing: false
          });
          _Toast2.default.info('选择的起始时间应小于结束时间哦', 2);
          return;
        }
        if (data.code !== 1) {
          _this4.setState({
            refreshing: false
          });
          _Toast2.default.info('' + data.message, 2);
          return;
        }
        _this4.setState({
          dataSourceTwo: _this4.state.dataSourceTwo.cloneWithRows(data.data.res_list),
          refreshingTwo: false
        });
        dataSourceListTwo = data.data.res_list;
        if (dataSourceListTwo.length === 0) {
          _Toast2.default.info('没有数据', 2);
        }
        _this4.pageNowTwo = 1;
        lockedTwo = 1;
      });
    }
  }, {
    key: 'onStartChange',
    value: function onStartChange(date) {
      var _this5 = this;

      if (this.state.endDate) {
        var params = {
          ofset: this.ofset,
          begintime: date.format('YYYY-MM-DD'),
          endtime: this.state.endDate.format('YYYY-MM-DD')
        };
        _Toast2.default.loading('');
        (0, _utils.post)('http://credit.xianjincard.com/credit-fund/fund-salculate', params).then(function (data) {
          return data.data;
        }).then(function (data) {
          _Toast2.default.hide();
          if (data.code === 103) {
            _Toast2.default.info('请先登录哦', 2);
            _utils.redirect.push('/employer/login');
            return;
          }
          if (data.code === -3) {
            _Toast2.default.info('选择的起始时间应小于结束时间哦', 2);
            return;
          }
          if (data.code !== 1) {
            _Toast2.default.info('' + data.message, 2);
            return;
          }
          _this5.setState({
            dataSource: _this5.state.dataSource.cloneWithRows(data.data.res_list)
          });
          dataSourceListOne = data.data.res_list;
          if (dataSourceListOne.length === 0) {
            _Toast2.default.info('没有数据', 2);
          }
          _this5.pageNow = 1;
          locked = 1;
          setTimeout(function () {
            _this5.refs.lvOne.refs.listview.scrollTo(0, 0);
          });
        });
      }
      this.setState({ startDate: date });
    }
  }, {
    key: 'onEndChange',
    value: function onEndChange(date) {
      var _this6 = this;

      if (this.state.startDate) {
        var params = {
          ofset: this.ofset,
          begintime: this.state.startDate.format('YYYY-MM-DD'),
          endtime: date.format('YYYY-MM-DD')
        };
        _Toast2.default.loading('');
        (0, _utils.post)('http://credit.xianjincard.com/credit-fund/fund-salculate', params).then(function (data) {
          return data.data;
        }).then(function (data) {
          _Toast2.default.hide();
          if (data.code === 103) {
            _Toast2.default.info('请先登录哦', 2);
            _utils.redirect.push('/employer/login');
            return;
          }
          if (data.code === -3) {
            _Toast2.default.info('选择的起始时间应小于结束时间哦', 2);
            return;
          }
          if (data.code !== 1) {
            _Toast2.default.info('' + data.message, 2);
            return;
          }
          _this6.setState({
            dataSource: _this6.state.dataSource.cloneWithRows(data.data.res_list)
          });
          dataSourceListOne = data.data.res_list;
          if (dataSourceListOne.length === 0) {
            _Toast2.default.info('没有数据', 2);
          }
          _this6.pageNow = 1;
          locked = 1;
          setTimeout(function () {
            _this6.refs.lvOne.refs.listview.scrollTo(0, 0);
          });
        });
      }
      this.setState({ endDate: date });
    }
  }, {
    key: 'onStartChangeTwo',
    value: function onStartChangeTwo(date) {
      var _this7 = this;

      if (this.state.endDateTwo) {
        var params = {
          ofset: this.ofset,
          begintime: date.format('YYYY-MM-DD'),
          endtime: this.state.endDateTwo.format('YYYY-MM-DD')
        };
        _Toast2.default.loading('');
        (0, _utils.post)('http://credit.xianjincard.com/credit-fund/fund-order-list', params).then(function (data) {
          return data.data;
        }).then(function (data) {
          _Toast2.default.hide();
          if (data.code === 103) {
            _Toast2.default.info('请先登录哦', 2);
            _utils.redirect.push('/employer/login');
            return;
          }
          if (data.code === -3) {
            _Toast2.default.info('选择的起始时间应小于结束时间哦', 2);
            return;
          }
          if (data.code !== 1) {
            _Toast2.default.info('' + data.message, 2);
            return;
          }
          _this7.setState({
            dataSourceTwo: _this7.state.dataSourceTwo.cloneWithRows(data.data.res_list)
          });
          dataSourceListTwo = data.data.res_list;
          if (dataSourceListTwo.length === 0) {
            _Toast2.default.info('没有数据', 2);
          }
          _this7.pageNowTwo = 1;
          lockedTwo = 1;
          setTimeout(function () {
            _this7.refs.lvTwo.refs.listview.scrollTo(0, 0);
          });
        });
      }
      this.setState({ startDateTwo: date });
    }
  }, {
    key: 'onEndChangeTwo',
    value: function onEndChangeTwo(date) {
      var _this8 = this;

      if (this.state.startDateTwo) {
        var params = {
          ofset: this.ofset,
          begintime: this.state.startDateTwo.format('YYYY-MM-DD'),
          endtime: date.format('YYYY-MM-DD')
        };
        _Toast2.default.loading('');
        (0, _utils.post)('http://credit.xianjincard.com/credit-fund/fund-order-list', params).then(function (data) {
          return data.data;
        }).then(function (data) {
          _Toast2.default.hide();
          if (data.code === 103) {
            _Toast2.default.info('请先登录哦', 2);
            _utils.redirect.push('/employer/login');
            return;
          }
          if (data.code === -3) {
            _Toast2.default.info('选择的起始时间应小于结束时间哦', 2);
            return;
          }
          if (data.code !== 1) {
            _Toast2.default.info('' + data.message, 2);
            return;
          }
          _this8.setState({
            dataSourceTwo: _this8.state.dataSourceTwo.cloneWithRows(data.data.res_list)
          });
          dataSourceListTwo = data.data.res_list;
          if (dataSourceListTwo.length === 0) {
            _Toast2.default.info('没有数据', 2);
          }
          _this8.pageNowTwo = 1;
          lockedTwo = 1;
          setTimeout(function () {
            _this8.refs.lvTwo.refs.listview.scrollTo(0, 0);
          });
        });
      }
      this.setState({ endDateTwo: date });
    }
  }, {
    key: 'formatNumber',
    value: function formatNumber(str) {
      var strNum = str / 100;
      return strNum.toFixed(2);
    }
  }, {
    key: 'onEndReachedOne',
    value: function onEndReachedOne(e) {
      var _this9 = this;

      if (dataSourceListOne.length < 20) {
        return;
      }
      if (locked) {
        locked = 0;
        this.pageNow = this.pageNow + 1;
        var params = {
          ofset: this.ofset,
          page: this.pageNow
        };
        if (this.state.startDate && this.state.endDate) {
          params = {
            ofset: this.ofset,
            page: this.pageNow,
            begintime: this.state.startDate.format('YYYY-MM-DD'),
            endtime: this.state.endDate.format('YYYY-MM-DD')
          };
        }
        (0, _utils.post)('http://credit.xianjincard.com/credit-fund/fund-salculate', params).then(function (data) {
          return data.data;
        }).then(function (data) {
          if (data.code === 103) {
            _Toast2.default.info('请先登录哦', 2);
            _utils.redirect.push('/employer/login');
            return;
          }
          for (var i in data.data.res_list) {
            dataSourceListOne.push(data.data.res_list[i]);
          }
          _this9.setState({
            dataSource: _this9.state.dataSource.cloneWithRows(dataSourceListOne)
          });
          if (dataSourceListOne.length === Number(data.data.count)) {
            _Toast2.default.info('已全部加载', 2);
            return;
          }
          locked = 1;
        });
      }
    }
  }, {
    key: 'onEndReachedTwo',
    value: function onEndReachedTwo(e) {
      var _this10 = this;

      if (dataSourceListTwo.length < 20) {
        return;
      }
      if (lockedTwo) {
        lockedTwo = 0;
        this.pageNowTwo = this.pageNowTwo + 1;
        var params = {
          ofset: this.ofset,
          page: this.pageNowTwo
        };
        if (this.state.startDateTwo && this.state.endDateTwo) {
          params = {
            ofset: this.ofset,
            page: this.pageNowTwo,
            begintime: this.state.startDateTwo.format('YYYY-MM-DD'),
            endtime: this.state.endDateTwo.format('YYYY-MM-DD')
          };
        }
        (0, _utils.post)('http://credit.xianjincard.com/credit-fund/fund-order-list', params).then(function (data) {
          return data.data;
        }).then(function (data) {
          if (data.code === 103) {
            _Toast2.default.info('请先登录哦', 2);
            _utils.redirect.push('/employer/login');
            return;
          }
          for (var i in data.data.res_list) {
            dataSourceListTwo.push(data.data.res_list[i]);
          }
          _this10.setState({
            dataSourceTwo: _this10.state.dataSourceTwo.cloneWithRows(dataSourceListTwo)
          });
          if (dataSourceListTwo.length === Number(data.data.count)) {
            _Toast2.default.info('已全部加载', 2);
            return;
          }
          lockedTwo = 1;
        });
      }
    }
  }, {
    key: 'render',
    value: function render() {
      var _this11 = this;

      var separator = function separator(sectionID, rowID) {
        return _react2.default.createElement('div', { className: 'line', key: rowID });
      };
      var row = function row(rowData, sectionID, rowID) {
        var obj = rowData;
        return _react2.default.createElement('div', { key: rowID, className: 'content' }, _react2.default.createElement('span', { className: 'one' }, obj.date.slice(2)), _react2.default.createElement('span', { className: 'two' }, _this11.formatNumber(obj.money_amount)), _react2.default.createElement('span', { className: 'three' }, _this11.formatNumber(obj.remaining_quota)), _react2.default.createElement('span', { className: 'four' }, _this11.formatNumber(obj.fund_service_fee)), _react2.default.createElement('span', { className: 'five' }, obj.count_nums));
      };
      var rowTwo = function rowTwo(rowData, sectionID, rowID) {
        var obj = rowData;
        return _react2.default.createElement('div', { key: rowID, className: 'content' }, _react2.default.createElement('span', { className: 'one' }, obj.loan_time.slice(2, 10)), _react2.default.createElement('span', { className: 'tel' }, obj.phone), _react2.default.createElement('span', { className: 'loan' }, _this11.formatNumber(obj.money_amount)), _react2.default.createElement('span', { className: 'loan-day' }, obj.loan_term, '\u5929'), _react2.default.createElement('span', { className: 'service-pay' }, _this11.formatNumber(obj.fund_service_fee)));
      };
      return _react2.default.createElement('div', { className: 'transition-group fund-security-certification list-body' }, _react2.default.createElement(_tabs2.default, { defaultActiveKey: '1', swipeable: false }, _react2.default.createElement(TabPane, { tab: '\u653E\u6B3E\u7EDF\u8BA1', key: '1' }, _react2.default.createElement('div', { style: { background: '#fff' } }, _react2.default.createElement('div', { className: 'date-div' }, _react2.default.createElement('div', { className: 'date-picker' }, _react2.default.createElement(_datePicker2.default, { mode: 'date', title: '\u9009\u62E9\u65E5\u671F', extra: '\u8BF7\u9009\u62E9\u5F00\u59CB\u65E5\u671F(\u53EF\u9009)', value: this.state.startDate, onChange: this.onStartChange.bind(this) }, _react2.default.createElement(CustomChildren, null))), _react2.default.createElement('div', { className: 'date-separator' }, '\u2014'), _react2.default.createElement('div', { className: 'date-picker' }, _react2.default.createElement(_datePicker2.default, { mode: 'date', title: '\u9009\u62E9\u65E5\u671F', extra: '\u8BF7\u9009\u62E9\u7ED3\u675F\u65E5\u671F(\u53EF\u9009)', value: this.state.endDate, onChange: this.onEndChange.bind(this) }, _react2.default.createElement(CustomChildren, null)))), _react2.default.createElement('div', { className: 'head' }, _react2.default.createElement('span', null, '\u65E5\u671F'), _react2.default.createElement('span', null, '\u653E\u6B3E\u91D1\u989D'), _react2.default.createElement('span', null, '\u5269\u4F59\u91D1\u989D'), _react2.default.createElement('span', null, '\u8D44\u65B9\u670D\u52A1\u8D39'), _react2.default.createElement('span', null, '\u653E\u6B3E\u7B14\u6570')), _react2.default.createElement(_listView2.default, {
        ref: 'lvOne',
        dataSource: this.state.dataSource,
        renderRow: row,
        renderSeparator: separator,
        initialListSize: 20,
        pageSize: 20,
        scrollRenderAheadDistance: 200,
        scrollEventThrottle: 20,
        className: 'listview',
        scrollerOptions: { scrollbars: true },
        onEndReached: this.onEndReachedOne.bind(this),
        onEndReachedThreshold: 10,
        refreshControl: _react2.default.createElement(_refreshControl2.default, {
          refreshing: this.state.refreshing,
          onRefresh: this.onRefresh.bind(this),
          distanceToRefresh: 40 / 2 * (window.devicePixelRatio || 2)
        })
      }))), _react2.default.createElement(TabPane, { tab: '\u8BA2\u5355\u603B\u8BA1', key: '2' }, _react2.default.createElement('div', { style: { background: '#fff' } }, _react2.default.createElement('div', { className: 'date-div' }, _react2.default.createElement('div', { className: 'date-picker' }, _react2.default.createElement(_datePicker2.default, { mode: 'date', title: '\u9009\u62E9\u65E5\u671F', extra: '\u8BF7\u9009\u62E9\u5F00\u59CB\u65E5\u671F(\u53EF\u9009)', value: this.state.startDateTwo, onChange: this.onStartChangeTwo.bind(this) }, _react2.default.createElement(CustomChildren, null))), _react2.default.createElement('div', { className: 'date-separator' }, '\u2014'), _react2.default.createElement('div', { className: 'date-picker' }, _react2.default.createElement(_datePicker2.default, { mode: 'date', title: '\u9009\u62E9\u65E5\u671F', extra: '\u8BF7\u9009\u62E9\u7ED3\u675F\u65E5\u671F(\u53EF\u9009)', value: this.state.endDateTwo, onChange: this.onEndChangeTwo.bind(this) }, _react2.default.createElement(CustomChildren, null)))), _react2.default.createElement('div', { className: 'head' }, _react2.default.createElement('span', null, '\u65E5\u671F'), _react2.default.createElement('span', { className: 'tel' }, '\u624B\u673A\u53F7'), _react2.default.createElement('span', { className: 'loan' }, '\u501F\u6B3E\u91D1\u989D'), _react2.default.createElement('span', { className: 'day' }, '\u501F\u6B3E\u5929\u6570'), _react2.default.createElement('span', { className: 'service' }, '\u8D44\u65B9\u670D\u52A1\u8D39')), _react2.default.createElement(_listView2.default, {
        ref: 'lvTwo',
        dataSource: this.state.dataSourceTwo,
        renderRow: rowTwo,
        renderSeparator: separator,
        initialListSize: 20,
        pageSize: 20,
        scrollRenderAheadDistance: 200,
        scrollEventThrottle: 20,
        className: 'listview',
        scrollerOptions: { scrollbars: true },
        onEndReached: this.onEndReachedTwo.bind(this),
        onEndReachedThreshold: 10,
        refreshControl: _react2.default.createElement(_refreshControl2.default, {
          refreshing: this.state.refreshingTwo,
          onRefresh: this.onRefreshTwo.bind(this),
          distanceToRefresh: 40 / 2 * (window.devicePixelRatio || 2)
        })
      })))), _react2.default.createElement(_whiteSpace2.default, null));
    }
  }]);
  return Thelist;
}(_react2.default.Component);

exports.default = Thelist;
module.exports = exports['default'];