'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = undefined;

var _css = require('antd-mobile/lib/textarea-item/style/css');

var _textareaItem = require('antd-mobile/lib/textarea-item');

var _textareaItem2 = _interopRequireDefault(_textareaItem);

var _css2 = require('antd-mobile/lib/picker/style/css');

var _picker = require('antd-mobile/lib/picker');

var _picker2 = _interopRequireDefault(_picker);

var _css3 = require('antd-mobile/lib/input-item/style/css');

var _inputItem = require('antd-mobile/lib/input-item');

var _inputItem2 = _interopRequireDefault(_inputItem);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _css4 = require('antd-mobile/lib/modal/style/css');

var _modal = require('antd-mobile/lib/modal');

var _modal2 = _interopRequireDefault(_modal);

var _css5 = require('antd-mobile/lib/toast/style/css');

var _toast = require('antd-mobile/lib/toast');

var _toast2 = _interopRequireDefault(_toast);

var _css6 = require('antd-mobile/lib/list/style/css');

var _list = require('antd-mobile/lib/list');

var _list2 = _interopRequireDefault(_list);

var _qs = require('qs');

var _qs2 = _interopRequireDefault(_qs);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _Register = require('components/Register');

var _Register2 = _interopRequireDefault(_Register);

var _utils = require('utils');

var _classnames = require('classnames');

var _classnames2 = _interopRequireDefault(_classnames);

require('scss/components/reboot.component.scss');

require('scss/misc/business.component.scss');

var _data = require('./data');

var _data2 = _interopRequireDefault(_data);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var Item = _list2.default.Item;

var title = '招募合作';
var lock = true;
var url = '//apimerchant.xianjincard.com/interface/save-apply-info';
var timer = void 0;

var ID = 'jsonp' + Date.now();
function request() {
    var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    var script = document.getElementById(ID);
    var element = script || document.createElement('script');

    !!!script && (element.id = ID, document.body.appendChild(element));

    data.v = Date.now();
    data.callback = 'callback';
    element.src = url + '?' + _qs2.default.stringify(data);
}
// jsonp callback
window.callback = function (response) {
    var code = response.code,
        message = response.message;

    if (code != 0) {
        _toast2.default.fail(message, 1);
    } else {
        _modal2.default.alert('系统提示', message);
        var forms = document.querySelectorAll('input,textarea');
        for (var i in forms) {
            if (forms.hasOwnProperty(i)) {
                forms[i].value = '';
            }
        }
    }
    lock = true;
};

var Welcome = function (_Component) {
    (0, _inherits3.default)(Welcome, _Component);

    function Welcome(props) {
        (0, _classCallCheck3.default)(this, Welcome);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Welcome.__proto__ || (0, _getPrototypeOf2.default)(Welcome)).call(this, props));

        _this.state = {
            areas: '',
            value: undefined,
            loaded: 1,
            lock: 0,
            visible: 0
        };
        return _this;
    }

    (0, _createClass3.default)(Welcome, [{
        key: 'componentDidMount',
        value: function componentDidMount() {
            document.title = title;
        }
    }, {
        key: 'areas',
        value: function areas(value) {
            this.setState({
                value: value
            });
        }
    }, {
        key: 'format',
        value: function format(values) {
            var _this2 = this;

            var areas = values.join(' ');
            setTimeout(function () {
                _this2.setState({
                    areas: areas
                });
            });
            return areas;
        }
    }, {
        key: 'remark',
        value: function remark(_remark) {
            this.setState({
                remark: _remark
            });
        }
    }, {
        key: 'submit',
        value: function submit() {
            var _state = this.state,
                areas = _state.areas,
                lock = _state.lock;
            var _refs = this.refs,
                channel_name = _refs.channel_name.refs.input,
                relation_name = _refs.relation_name.refs.input,
                relation_phone = _refs.relation_phone.refs.input,
                remark = _refs.remark.refs.textarea;

            if (!!!lock) {
                if (!!!channel_name.value) {
                    _toast2.default.offline('渠道商名称不能为空', 1, function () {
                        channel_name.focus();
                    });
                    return;
                } else if (!!!relation_name.value) {
                    _toast2.default.offline('姓名不能为空', 1, function () {
                        relation_name.focus();
                    });
                    return;
                } else if (!!!relation_phone.value) {
                    _toast2.default.offline('电话不能为空', 1, function () {
                        relation_phone.focus();
                    });
                    return;
                } else if (!!!areas) {
                    _toast2.default.offline('合作地区不能为空');
                    return;
                } else if (!!!remark.value) {
                    _toast2.default.offline('备注不能为空', 1, function () {
                        remark.focus();
                    });
                    return;
                }
                lock = !lock;
                request({
                    channel_name: channel_name.value,
                    channel_area: areas,
                    relation_name: relation_name.value,
                    relation_phone: relation_phone.value,
                    remark: remark.value
                });
            }
        }
    }, {
        key: 'render',
        value: function render() {
            var _state2 = this.state,
                remark = _state2.remark,
                value = _state2.value,
                loaded = _state2.loaded,
                lock = _state2.lock,
                visible = _state2.visible;

            return _react2.default.createElement('div', { className: (0, _classnames2.default)({ wrapper: true, loaded: loaded }) }, _react2.default.createElement('div', { className: 'form' }, _react2.default.createElement('div', { className: 'form-group' }, _react2.default.createElement(_inputItem2.default, { ref: 'channel_name', name: 'channel_name', placeholder: '\u6E20\u9053\u5546\u540D\u79F0' })), _react2.default.createElement('div', { className: 'form-group form-inline' }, _react2.default.createElement(_inputItem2.default, { ref: 'relation_name', name: 'relation_name', placeholder: '\u59D3\u540D' }), _react2.default.createElement(_inputItem2.default, { ref: 'relation_phone', name: 'relation_phone', placeholder: '\u7535\u8BDD' })), _react2.default.createElement('div', { className: 'form-group' }, _react2.default.createElement(_picker2.default, { className: 'areas', cols: 2, data: _data2.default, value: value, extra: '\u5408\u4F5C\u533A\u57DF', format: this.format.bind(this), onChange: this.areas.bind(this), onPickerChange: this.areas.bind(this) }, _react2.default.createElement(Item, { className: (0, _classnames2.default)({ 'am-area-item': true, active: !!value }), arrow: 'down' }))), _react2.default.createElement('div', { className: 'form-group' }, _react2.default.createElement(_textareaItem2.default, { onChange: this.remark.bind(this), ref: 'remark', name: 'remark', value: remark, rows: 5, count: 140, placeholder: '\u5907\u6CE8\u5185\u5BB9\uFF08\u56E2\u961F\u4ECB\u7ECD\u3001\u8D26\u52A1\u7684\u8D44\u6E90\u60C5\u51B5\u7B49\uFF09' })), _react2.default.createElement('div', { className: 'form-group' }, _react2.default.createElement('div', { className: (0, _classnames2.default)({ 'button-submit': true, disabled: lock }), onClick: this.submit.bind(this) }, '\u786E\u8BA4\u63D0\u4EA4'))));
        }
    }]);
    return Welcome;
}(_react.Component);

exports.default = Welcome;
module.exports = exports['default'];