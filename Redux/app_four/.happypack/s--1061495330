'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _css = require('antd-mobile/lib/white-space/style/css');

var _whiteSpace = require('antd-mobile/lib/white-space');

var _whiteSpace2 = _interopRequireDefault(_whiteSpace);

var _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _css2 = require('antd-mobile/lib/tabs/style/css');

var _tabs = require('antd-mobile/lib/tabs');

var _tabs2 = _interopRequireDefault(_tabs);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _utils = require('utils');

var _Toast = require('../../../components/Toast');

var _Toast2 = _interopRequireDefault(_Toast);

require('scss/activity/invite.component.scss');

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

var TabPane = _tabs2.default.TabPane;

var Reward = function (_React$Component) {
  (0, _inherits3.default)(Reward, _React$Component);

  function Reward(props) {
    (0, _classCallCheck3.default)(this, Reward);

    var _this = (0, _possibleConstructorReturn3.default)(this, (Reward.__proto__ || (0, _getPrototypeOf2.default)(Reward)).call(this, props));

    _this.pageOne = 0;
    _this.pageTwo = 0;
    _this.loadTwo = 1;
    _this.state = {
      cashState: false,
      popupState: {
        isShow: false,
        tip: '',
        content: '',
        callback: ''
      },
      firstInvitation: [],
      secondInvitation: [],
      moreOneFlag: false,
      moreTwoFlag: false,
      index: {}
    };
    return _this;
  }

  (0, _createClass3.default)(Reward, [{
    key: 'componentDidMount',
    value: function componentDidMount() {
      var _this2 = this;

      document.title = '我的奖金';
      _Toast2.default.loading('');
      (0, _utils.get)('http://credit.xianjincard.com/credit-invite/index').then(function (data) {
        return data.data;
      }).then(function (data) {
        _Toast2.default.hide();
        if (data.code === -1001) {
          (0, _utils.login)();
          return;
        }
        if (data.code !== 0) {
          _this2.popupInfo('服务器繁忙 请稍候再试', '朕知道了');
          return;
        }
        _this2.setState({ index: data.data });
        _this2.loadMoreOne();
      });
    }
  }, {
    key: 'changeTabs',
    value: function changeTabs(key) {
      if (key === '2' && this.loadTwo) {
        this.loadTwo = 0;
        this.loadMoreTwo();
      }
    }
  }, {
    key: 'showRule',
    value: function showRule(e) {
      this.setState({ cashState: true });
    }
  }, {
    key: 'closeRule',
    value: function closeRule(e) {
      this.setState({ cashState: false });
    }
  }, {
    key: 'loadMoreOne',
    value: function loadMoreOne() {
      var _this3 = this;

      this.pageOne++;
      _Toast2.default.loading('');
      (0, _utils.get)('http://credit.xianjincard.com/credit-invite/list-one?page=' + this.pageOne).then(function (data) {
        return data.data;
      }).then(function (data) {
        _Toast2.default.hide();
        if (data.code === -1001) {
          (0, _utils.login)();
          return;
        }
        if (data.code !== 0) {
          _this3.popupInfo('服务器繁忙 请稍候再试', '朕知道了');
          return;
        }
        if (data.data.list.length === 15) {
          _this3.setState({ moreOneFlag: true });
        }
        _this3.setState({ firstInvitation: [].concat((0, _toConsumableArray3.default)(_this3.state.firstInvitation), (0, _toConsumableArray3.default)(data.data.list)) });
        if (data.data.list.length < 15 && _this3.state.firstInvitation.length !== 0) {
          _Toast2.default.info('已全部加载', 2);
          _this3.setState({ moreOneFlag: false });
        }
      });
    }
  }, {
    key: 'loadMoreTwo',
    value: function loadMoreTwo() {
      var _this4 = this;

      this.pageTwo++;
      _Toast2.default.loading('');
      (0, _utils.get)('http://credit.xianjincard.com/credit-invite/list-two?page=' + this.pageTwo).then(function (data) {
        return data.data;
      }).then(function (data) {
        _Toast2.default.hide();
        if (data.code === -1001) {
          (0, _utils.login)();
          return;
        }
        if (data.code !== 0) {
          _this4.popupInfo('服务器繁忙 请稍候再试', '朕知道了');
          return;
        }
        if (data.data.list.length === 15) {
          _this4.setState({ moreTwoFlag: true });
        }
        _this4.setState({ secondInvitation: [].concat((0, _toConsumableArray3.default)(_this4.state.secondInvitation), (0, _toConsumableArray3.default)(data.data.list)) });
        if (data.data.list.length < 15 && _this4.state.secondInvitation.length !== 0) {
          _Toast2.default.info('已全部加载', 2);
          _this4.setState({ moreTwoFlag: false });
        }
      });
    }
  }, {
    key: 'goBind',
    value: function goBind() {
      if (!_utils.platform.isApp) {
        this.popupInfo('请下载最新的APP，<br />完成绑卡之后再提现哦！', '立即下载', _utils.forwardApp);
        return;
      }
      if (typeof nativeMethod !== 'undefined') {
        window.nativeMethod.returnNativeMethod('{"type":"3"}');
      }
    }
  }, {
    key: 'drawal',
    value: function drawal() {
      if (this.state.index.account / 100 < 30) {
        return;
      }
      if (!_utils.platform.isApp) {
        this.popupInfo('请下载最新的APP，<br />到“我的”-“现金红包”提现', '立即下载', _utils.forwardApp);
        return;
      }
      var versionArr = _utils.platform.version.split('.');
      var version = parseInt(versionArr[0] + versionArr[1] + versionArr[2], 10);
      if (version < 147) {
        this.popupInfo('您的版本过旧，<br />请下载最新APP，<br />到“我的”-“现金红包”提现', '朕知道了');
        return;
      }
      this.popupInfo('请到“我的”-“现金红包”提现', '朕知道了');
    }
  }, {
    key: 'popupInfo',
    value: function popupInfo(content, tip, callback) {
      this.setState({
        popupState: {
          isShow: true,
          content: content,
          tip: tip,
          callback: callback
        }
      });
    }
  }, {
    key: 'closePopup',
    value: function closePopup(e) {
      this.setState({ popupState: { isShow: false } });
    }
  }, {
    key: 'okPopup',
    value: function okPopup(e) {
      this.state.popupState.callback && this.state.popupState.callback();
      this.closePopup();
    }
  }, {
    key: 'render',
    value: function render() {
      var _state = this.state,
          cashState = _state.cashState,
          popupState = _state.popupState,
          firstInvitation = _state.firstInvitation,
          secondInvitation = _state.secondInvitation,
          moreOneFlag = _state.moreOneFlag,
          moreTwoFlag = _state.moreTwoFlag,
          index = _state.index;

      var topList = index.top_ad ? index.top_ad.map(function (v, i) {
        return _react2.default.createElement('span', { key: i }, v.encode_name, ' \u6210\u529F\u7533\u8BF7', _react2.default.createElement('i', null, v.count), '\u4EBA\uFF0C\u9886\u53D6\u5956\u52B1', _react2.default.createElement('i', null, v.total_money / 100), '\u5143\uFF1B');
      }) : null;

      var top = index.is_bind_card ? _react2.default.createElement('p', null, topList) : _react2.default.createElement('div', { className: 'no-bind clearfix' }, _react2.default.createElement('span', null, '\u82E5\u8981\u9886\u53D6\u5956\u91D1\uFF0C\u8BF7\u5148\u7ED1\u5B9A\u94F6\u884C\u5361'), _react2.default.createElement('a', { onClick: this.goBind.bind(this) }, '\u53BB\u7ED1\u5361>'));

      var listOne = firstInvitation.length > 0 ? firstInvitation.map(function (v, i) {
        return _react2.default.createElement('div', { className: 'list', key: i }, _react2.default.createElement('p', null, v.name, _react2.default.createElement('br', null), _react2.default.createElement('small', null, v.record_time)), _react2.default.createElement('p', null, '\u6210\u529F\u7533\u8BF7', _react2.default.createElement('br', null), _react2.default.createElement('small', null, v.amount / 100)), _react2.default.createElement('p', null, v.rebate / 100));
      }) : _react2.default.createElement('div', { className: 'no-list' }, '\u6682\u65E0\u8FD4\u5229\u8BB0\u5F55');

      var listTwo = secondInvitation.length > 0 ? secondInvitation.map(function (v, i) {
        return _react2.default.createElement('div', { className: 'list', key: i }, _react2.default.createElement('p', null, v.name, _react2.default.createElement('br', null), _react2.default.createElement('small', null, v.record_time)), _react2.default.createElement('p', null, '\u6210\u529F\u7533\u8BF7', _react2.default.createElement('br', null), _react2.default.createElement('small', null, v.amount / 100)), _react2.default.createElement('p', null, v.rebate / 100));
      }) : _react2.default.createElement('div', { className: 'no-list' }, '\u6682\u65E0\u8FD4\u5229\u8BB0\u5F55');

      var cash = cashState ? _react2.default.createElement('div', { className: 'rule cash' }, _react2.default.createElement('div', { className: 'overlay', onClick: this.closeRule.bind(this) }), _react2.default.createElement('div', { className: 'dialog' }, _react2.default.createElement('span', { className: 'close', onClick: this.closeRule.bind(this) }), _react2.default.createElement('h3', null, '\u63D0\u73B0\u8BF4\u660E'), _react2.default.createElement('div', { className: 'rule-content' }, _react2.default.createElement('p', null, '1\u3001\u6BCF\u4E2A\u5468\u53EF\u7533\u8BF7\u4E00\u6B21\u73B0\u91D1\u63D0\u73B0\uFF1B'), _react2.default.createElement('p', null, '2\u3001\u7D2F\u8BA1\u6EE130\u5143\u624D\u53EF\u4EE5\u63D0\u73B0\uFF0C\u4E14\u53EA\u80FD\u5168\u989D\u63D0\u53D6\uFF1B'), _react2.default.createElement('p', null, '3\u3001\u5904\u4E8E\u903E\u671F\u72B6\u6001\u4E2D\u7684\u7528\u6237\u9700\u5148\u8FD8\u6B3E\u624D\u53EF\u4EE5\u63D0\u73B0'), _react2.default.createElement('p', null, '4\u3001\u7533\u8BF7\u6210\u529F\u540E\uFF0C\u5956\u91D1\u5C06\u57283\u4E2A\u5DE5\u4F5C\u65E5\u5185\u53D1\u653E\u5230\u60A8\u7ED1\u5B9A\u7684\u94F6\u884C\u5361\u4E0A;'), _react2.default.createElement('p', null, '5\u3001\u5982\u9047\u6CD5\u5B9A\u8282\u5047\u65E5\uFF0C\u63D0\u73B0\u8FDB\u5EA6\u987A\u5EF6\uFF1B'), _react2.default.createElement('p', null, '6\u3001\u5982\u6709\u95EE\u9898\u8BF7\u62E8\u6253\u5BA2\u670D\u70ED\u7EBF021-80260893')))) : null;

      var moreOne = moreOneFlag ? _react2.default.createElement('p', { className: 'more', onClick: this.loadMoreOne.bind(this) }, '\u70B9\u51FB\u52A0\u8F7D\u66F4\u591A') : null;

      var moreTwo = moreTwoFlag ? _react2.default.createElement('p', { className: 'more', onClick: this.loadMoreTwo.bind(this) }, '\u70B9\u51FB\u52A0\u8F7D\u66F4\u591A') : null;

      var popup = popupState.isShow ? _react2.default.createElement('div', { className: 'popup popup-confirm' }, _react2.default.createElement('div', { className: 'overlay', onClick: this.closePopup.bind(this) }), _react2.default.createElement('div', { className: 'dialog confirm-dialog' }, _react2.default.createElement('span', { className: 'close', onClick: this.closePopup.bind(this) }), _react2.default.createElement('p', { dangerouslySetInnerHTML: { __html: popupState.content } }), _react2.default.createElement('a', { onClick: this.okPopup.bind(this) }, popupState.tip))) : null;

      return _react2.default.createElement('div', { className: 'transition-group' }, _react2.default.createElement('div', { className: 'reward' }, _react2.default.createElement('div', { className: 'top' }, top), _react2.default.createElement('div', { className: 'head' }, _react2.default.createElement('p', null, '\u5F53\u524D\u53EF\u63D0\u73B0\u5956\u91D1'), _react2.default.createElement('h1', null, index.account ? (index.account / 100).toFixed(2) : 0 .toFixed(2), _react2.default.createElement('span', null, '\u5143')), _react2.default.createElement('p', null, '\u5386\u53F2\u83B7\u5F97\u5956\u91D1\uFF1A', index.invite_account ? index.invite_account / 100 : 0, '\u5143'), _react2.default.createElement('a', { className: index.account / 100 >= 30 ? '' : 'disabled', onClick: this.drawal.bind(this) }, '\u7ACB\u5373\u63D0\u73B0')), _react2.default.createElement(_tabs2.default, { defaultActiveKey: '1', swipeable: false, onChange: this.changeTabs.bind(this) }, _react2.default.createElement(TabPane, { tab: '\u4E00\u7EA7\u9080\u8BF7\u5956\u52B1', key: '1' }, _react2.default.createElement('div', { className: 'reward-content' }, listOne, moreOne)), _react2.default.createElement(TabPane, { tab: '\u4E8C\u7EA7\u9080\u8BF7\u5956\u52B1', key: '2' }, _react2.default.createElement('div', { className: 'reward-content' }, listTwo, moreTwo))), _react2.default.createElement(_whiteSpace2.default, null), cash, popup, _react2.default.createElement('a', { className: 'a-cash', onClick: this.showRule.bind(this) }, '\u63D0\u73B0\u8BF4\u660E')));
    }
  }]);
  return Reward;
}(_react2.default.Component);

exports.default = Reward;
module.exports = exports['default'];