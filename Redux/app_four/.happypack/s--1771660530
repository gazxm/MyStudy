'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _css = require('antd-mobile/lib/button/style/css');

var _button = require('antd-mobile/lib/button');

var _button2 = _interopRequireDefault(_button);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _css2 = require('antd-mobile/lib/modal/style/css');

var _modal = require('antd-mobile/lib/modal');

var _modal2 = _interopRequireDefault(_modal);

var _css3 = require('antd-mobile/lib/list/style/css');

var _list = require('antd-mobile/lib/list');

var _list2 = _interopRequireDefault(_list);

var _dec, _class;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactRedux = require('react-redux');

var _utils = require('utils');

require('scss/components/fund-security.component.scss');

var _securityFundActions = require('../../actions/securityFundActions');

var fund = _interopRequireWildcard(_securityFundActions);

var _Toast = require('../../components/Toast');

var _Toast2 = _interopRequireDefault(_Toast);

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  } else {
    var newObj = {};if (obj != null) {
      for (var key in obj) {
        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];
      }
    }newObj.default = obj;return newObj;
  }
}

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

var Item = _list2.default.Item;
var alert = _modal2.default.alert;

// 0认证失败 1已认证 2认证中
var text = ['认证失败', '已认证', '认证中'];
var textClass = ['fail', 'succeed', 'fail'];

var FundList = (_dec = (0, _reactRedux.connect)(function (store) {
  var list = store.securityFund.list;
  return {
    items: list.items,
    fetched: list.fetched,
    fetching: list.fetching,
    code: list.code,
    message: list.message
  };
}), _dec(_class = function (_React$Component) {
  (0, _inherits3.default)(FundList, _React$Component);

  function FundList() {
    (0, _classCallCheck3.default)(this, FundList);
    return (0, _possibleConstructorReturn3.default)(this, (FundList.__proto__ || (0, _getPrototypeOf2.default)(FundList)).apply(this, arguments));
  }

  (0, _createClass3.default)(FundList, [{
    key: 'componentDidMount',
    value: function componentDidMount() {
      document.title = '公积金认证';
      this.isMask = true;
      clearTimeout(this.timeout);
      this.props.dispatch(fund.fetchFundList());
      // Toast.loading('加载中...', 3, function(){
      //   console.log('ok')
      // })
    }
  }, {
    key: 'componentWillUpdate',
    value: function componentWillUpdate(nextProps, nextState) {
      var fetching = nextProps.fetching;

      if (this.isMask) {
        fetching ? _Toast2.default.loading('加载中...') : _Toast2.default.hide();
      }
    }
  }, {
    key: 'componentDidUpdate',
    value: function componentDidUpdate(prevProps, prevState) {
      var _props = this.props,
          fetched = _props.fetched,
          code = _props.code,
          message = _props.message,
          items = _props.items;

      if (fetched && code === -3) {
        alert('登录', '你还没有登录，请先登录', [{ text: '确 定', onPress: function onPress() {
            return (0, _utils.login)();
          } }]);
        return;
      }
      if (fetched && code !== 0 && code !== 1 && code !== -3) {
        _Toast2.default.info(message, 2);
        return;
      }
      if (fetched && items.length <= 0) _utils.redirect.replace('/fund/certification');
    }
  }, {
    key: 'componentWillUnmount',
    value: function componentWillUnmount() {
      clearTimeout(this.timeout);
    }
  }, {
    key: 'poll',
    value: function poll(time) {
      var _this2 = this;

      this.timeout = setTimeout(function () {
        _this2.isMask = false;
        _this2.props.dispatch(fund.fetchFundList());
      }, time * 1000);
    }
  }, {
    key: 'render',
    value: function render() {
      var _this3 = this;

      var _props2 = this.props,
          items = _props2.items,
          fetched = _props2.fetched;

      var list = null;
      if (fetched && items && items.length) {
        items.map(function (item) {
          if (parseInt(item.status) === 2) {
            _this3.poll(10);
            return;
          }
        });
        list = items.map(function (item, i) {
          return _react2.default.createElement(Item, { key: i, extra: text[item.status], className: textClass[item.status] }, item.city);
        });
      }
      if (list === null) {
        return null;
      }
      return _react2.default.createElement('div', { className: 'transition-group fund-security-certification' }, _react2.default.createElement(_list2.default, { className: 'custom-list' }, list), _react2.default.createElement('div', { className: 'custom-button' }, _react2.default.createElement(_button2.default, { className: 'btn', type: 'primary', onClick: function onClick() {
          _utils.redirect.push('/fund/certification');
        } }, items ? '继续添加' : '添加')));
    }
  }]);
  return FundList;
}(_react2.default.Component)) || _class);
exports.default = FundList;
module.exports = exports['default'];