'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = undefined;

var _css = require('antd-mobile/lib/modal/style/css');

var _modal = require('antd-mobile/lib/modal');

var _modal2 = _interopRequireDefault(_modal);

var _css2 = require('antd-mobile/lib/toast/style/css');

var _toast = require('antd-mobile/lib/toast');

var _toast2 = _interopRequireDefault(_toast);

var _promise = require('babel-runtime/core-js/promise');

var _promise2 = _interopRequireDefault(_promise);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _request = require('common/request');

var _request2 = _interopRequireDefault(_request);

var _utils = require('utils');

var _DownloadPopup = require('../components/DownloadPopup');

var _DownloadPopup2 = _interopRequireDefault(_DownloadPopup);

var _classnames = require('classnames');

var _classnames2 = _interopRequireDefault(_classnames);

require('scss/components/reboot.component.scss');

require('scss/activity/thursday-freeinterest.component.scss');

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var title = '周四免息'; /* eslint-disable */

var lock = true;

var Welcome = function (_Component) {
    (0, _inherits3.default)(Welcome, _Component);

    function Welcome(props) {
        (0, _classCallCheck3.default)(this, Welcome);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Welcome.__proto__ || (0, _getPrototypeOf2.default)(Welcome)).call(this, props));

        _this.state = {
            time: '2017年3月23日00:00-3月23日24:00',
            rules: 0,
            visible: 0,
            loaded: 0,
            message: ''
        };
        _request2.default.interceptors.response.use(function (response) {
            var code = response.code,
                data = response.data,
                message = response.message;

            if ([0, 1000].indexOf(code) < 0) {
                return _promise2.default.reject(response);
            }
            return _promise2.default.resolve(response);
        });
        return _this;
    }

    (0, _createClass3.default)(Welcome, [{
        key: 'componentDidMount',
        value: function componentDidMount() {
            var _this2 = this;

            document.title = title;
            // share('thursday-freeinterest');
            _toast2.default.loading(undefined, 0);
            (0, _request2.default)('activity/interest-free-act/index').then(function (response) {
                var time = response.data.time;

                _this2.setState({
                    time: time,
                    loaded: 1
                });
                _toast2.default.hide();
            });
        }
    }, {
        key: 'middleware',
        value: function middleware(response) {
            var _this3 = this;

            var code = response.code,
                message = response.message,
                _response$visible = response.visible,
                visible = _response$visible === undefined ? 1 : _response$visible;

            if (code == -2024) {
                visible = 3;
                message = '亲，免息奖励与你插肩而过，下个时间段可以继续领哦！';
            } else if (code == -2025) {
                visible = 3;
                message = '亲，您已获得免息券一张请至"我的"-"优惠券"中查看，券有效期一天，请立即使用';
            } else if (code == -1001) {
                visible = 2;
                message = '登陆态失效';
            } else if (code == 0) {
                visible = 3;
                message = '亲，恭喜你获得免息券一张请至"我的"-"优惠券"中查看，券有效期一天，请立即使用';
            } else if (code == -2012) {
                visible = 1;
                message = '活动未开始';
            } else {
                visible = 1;
                message = '系统繁忙';
            }
            this.setState({
                message: message
            });
            setTimeout(function () {
                _this3.setState({
                    visible: visible
                });
            });
            lock = true;
        }
    }, {
        key: 'rules',
        value: function rules() {
            this.setState({
                rules: 1
            });
        }
    }, {
        key: 'close',
        value: function close() {
            this.setState({
                rules: 0,
                visible: 0
            });
        }
    }, {
        key: 'apply',
        value: function apply() {
            var _this4 = this;

            if (lock) {
                lock = !lock;
                (0, _request2.default)('activity/interest-free-act/interest?tag=h5-20170405-interestFree_act').then(function (response) {
                    var code = response.code,
                        message = response.message;

                    code == 0 && (response.message = '亲，恭喜你获得免息券一张请至"我的"-"优惠券"中查看');
                    _this4.middleware.apply(_this4, [response]);
                    lock = true;
                }).catch(this.middleware.bind(this));
            }
        }
    }, {
        key: 'login',
        value: function login() {
            (0, _utils.login)();
        }
    }, {
        key: 'loan',
        value: function loan() {
            if (_utils.platform.isApp) {
                (0, _utils.hrefNative)(4);
            } else {
                window.location.href = (0, _utils.resolveUrl)('http://h5.xianjincard.com/mobile');
            }
        }
    }, {
        key: 'render',
        value: function render() {
            var _state = this.state,
                time = _state.time,
                rules = _state.rules,
                visible = _state.visible,
                loaded = _state.loaded,
                message = _state.message;

            return _react2.default.createElement('div', { className: (0, _classnames2.default)({ wrapper: true, 'wrapper-thursday-freeinterest': true, loaded: loaded }) }, _react2.default.createElement('div', { className: 'tips' }, '\u7ED9\u4F60\u514D\u606F\u501F\uFF0C\u4E00\u8D77\u55E8\u8D77\u6765'), _react2.default.createElement('div', { className: 'button-receive', onClick: this.apply.bind(this) }, '\u9886\u53D6\u514D\u606F\u52A0\u6CB9\u5238'), _react2.default.createElement('div', { className: 'rule' }, _react2.default.createElement('span', { onClick: this.rules.bind(this) }, '\u67E5\u770B\u89C4\u5219')), _react2.default.createElement(_modal2.default, { visible: visible == 3, onClose: this.close.bind(this), maskClosable: true, transparent: true }, _react2.default.createElement('p', { className: 'message' }, message), _react2.default.createElement('div', { className: 'button', onClick: this.close.bind(this) }, '\u6715\u77E5\u9053\u4E86')), _react2.default.createElement(_modal2.default, { visible: visible == 2, onClose: this.close.bind(this), maskClosable: true, transparent: true }, _react2.default.createElement('p', { className: 'message' }, message), _react2.default.createElement('div', { className: 'button', onClick: this.login.bind(this) }, '\u9A6C\u4E0A\u767B\u5F55')), _react2.default.createElement(_modal2.default, { visible: visible == 1, onClose: this.close.bind(this), maskClosable: true, transparent: true }, _react2.default.createElement('p', { className: 'message' }, message), _react2.default.createElement('div', { className: 'button', onClick: this.close.bind(this) }, '\u6715\u77E5\u9053\u4E86')), _react2.default.createElement(_modal2.default, { className: 'rules', visible: rules, onClose: this.close.bind(this), maskClosable: true, transparent: true }, _react2.default.createElement('h5', null, '\u6D3B\u52A8\u89C4\u5219'), _react2.default.createElement('p', null, '\u6D3B\u52A8\u65F6\u95F4\uFF1A', time), _react2.default.createElement('p', null, '\u6D3B\u52A8\u5BF9\u8C61\uFF1A\u5E73\u53F0\u6CE8\u518C\u7528\u6237'), _react2.default.createElement('p', null, '\u6D3B\u52A8\u5956\u52B1\uFF1A\u70B9\u51FB\u201C\u9886\u53D6\u514D\u606F\u52A0\u6CB9\u5238\u201D\u6309\u94AE\uFF0C\u5373\u6709\u673A\u4F1A\u83B7\u5F97\u514D\u606F\u5238\u3002\u672C\u6D3B\u52A8\u5171\u67091000\u4E2A\u540D\u989D\uFF0C0:00-8:00\u53D1\u653E200\u4E2A\u540D\u989D\uFF0C8:00-16:00\u53D1\u653E500\u4E2A\u540D\u989D\uFF0C16:00-24:00\u53D1\u653E300\u4E2A\u540D\u989D\uFF0C\u968F\u673A\u53D1\u653E'), _react2.default.createElement('p', null, '\u514D\u606F\u5238\u6709\u6548\u671F\u81EA\u53D1\u653E\u4E4B\u65E5\u8D771\u5929\u5185\u6709\u6548'), _react2.default.createElement('p', null, '\u672C\u6D3B\u52A8\u6700\u7EC8\u89E3\u91CA\u6743\u5F52\u73B0\u91D1\u5361\u6240\u6709\uFF0C\u4E0EApple.Inc\u65E0\u5173')), _react2.default.createElement(_DownloadPopup2.default, null));
        }
    }]);
    return Welcome;
}(_react.Component);

exports.default = Welcome;
;
module.exports = exports['default'];