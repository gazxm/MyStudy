'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _Scroll = require('./Scroll');

var _Scroll2 = _interopRequireDefault(_Scroll);

var _Content = require('./Content');

var _Content2 = _interopRequireDefault(_Content);

var _Popup = require('../components/Popup');

var _Popup2 = _interopRequireDefault(_Popup);

var _Toast = require('../../../components/Toast');

var _Toast2 = _interopRequireDefault(_Toast);

var _utils = require('utils');

require('scss/activity/group-loan.component.scss');

require('img/activity/group-loan/group-loan-13.png');

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

var appMarket = 'GroupLoan';

var GroupLoan = function (_React$Component) {
  (0, _inherits3.default)(GroupLoan, _React$Component);

  function GroupLoan(props) {
    (0, _classCallCheck3.default)(this, GroupLoan);

    var _this = (0, _possibleConstructorReturn3.default)(this, (GroupLoan.__proto__ || (0, _getPrototypeOf2.default)(GroupLoan)).call(this, props));

    _this.inviteCode = '';
    _this.state = {
      groupName: '',
      groupCount: 0,
      groupType: 0,
      groupInviteCode: '',
      type: 0,
      unix: 0
    };
    return _this;
  }

  (0, _createClass3.default)(GroupLoan, [{
    key: 'componentWillMount',
    value: function componentWillMount() {
      var _this2 = this;

      if (Math.floor(new Date().getTime() / 1000) < 1493776800) {
        this.setState({
          unix: 1
        });
      }
      this.inviteCode = this.props.location.query.invite_code;
      if (!_utils.platform.isApp && this.inviteCode) {
        this.setState({
          type: 1
        });
        _Toast2.default.loading('');
        (0, _utils.get)('http://credit.xianjincard.com/activity/group-loan-act/index?invite_code=' + this.inviteCode).then(function (data) {
          return data.data;
        }).then(function (data) {
          _Toast2.default.hide();
          if (data.code !== 0) {
            _Popup2.default.alert(_Content2.default.showHtml(data.code), 'popup');
            _Popup2.default.click('a.click');
            return;
          }
          if (data.data.is_leader && _this2.inviteCode === data.data.cur_group_invite_code) {
            _this2.setState({
              groupName: data.data.title,
              groupCount: data.data.count,
              groupType: 2
            });
            return;
          }
          if (data.data.is_leader && _this2.inviteCode !== data.data.cur_group_invite_code) {
            _this2.setState({
              groupName: data.data.title,
              groupCount: data.data.count,
              groupType: 1,
              groupInviteCode: data.data.cur_group_invite_code
            });
            return;
          }
          if (!data.data.is_leader && _this2.inviteCode === data.data.cur_group_invite_code) {
            _this2.setState({
              groupName: data.data.title,
              groupCount: data.data.count,
              groupType: 2
            });
            return;
          }
          _this2.setState({
            groupName: data.data.title,
            groupCount: data.data.count,
            groupType: 0
          });
        });
      }
    }
  }, {
    key: 'componentDidMount',
    value: function componentDidMount() {
      document.title = '组团借款';
      (0, _utils.share)('groupLoan');
    }
  }, {
    key: 'open',
    value: function open() {
      _Toast2.default.loading('');
      (0, _utils.get)('http://credit.xianjincard.com/activity/group-loan-act/group?tag=h5-20170421-groupLoan_act').then(function (data) {
        return data.data;
      }).then(function (data) {
        _Toast2.default.hide();
        if (data.code !== 0) {
          _Popup2.default.alert(_Content2.default.showHtml(data.code), 'popup');
          if (data.code === -1001) {
            _Popup2.default.click('a.click', function () {
              (0, _utils.login)(appMarket);
            });
            return;
          }
          if (data.code === -2003) {
            _Popup2.default.click('a.click', function () {
              (0, _utils.goHome)();
            });
            return;
          }
          _Popup2.default.click('a.click');
          return;
        }
        _Popup2.default.alert(_Content2.default.showHtml(data.code, data.data.count, data.data.is_leader), 'popup');
        _Popup2.default.click('a.click', function () {
          var url = 'http://h.xianjincard.com/activity/group-loan?invite_code=' + data.data.invite_code;
          var imgUrl = 'http://h.xianjincard.com/assets/img/activity/group-loan/group-loan-13.png';
          (0, _utils.partake)({
            'share_title': '和我一起借，费用立减半',
            'share_body': '不分新老用户，通过这个链接借款，费用可减半，最快5分钟下款',
            'share_url': url,
            'share_logo': imgUrl
          });
        });
      });
    }
  }, {
    key: 'join',
    value: function join() {
      var _this3 = this;

      _Toast2.default.loading('');
      (0, _utils.get)('http://credit.xianjincard.com/activity/group-loan-act/senate?invite_code=' + this.inviteCode + '&tag=h5-20170421-groupLoan_act').then(function (data) {
        return data.data;
      }).then(function (data) {
        _Toast2.default.hide();
        if (data.code !== 0) {
          _Popup2.default.alert(_Content2.default.showHtml(data.code), 'popup');
          if (data.code === -1001) {
            _Popup2.default.click('a.click', function () {
              (0, _utils.login)(appMarket, _this3.inviteCode);
            });
            return;
          }
          _Popup2.default.click('a.click');
          return;
        }
        _Popup2.default.alert(_Content2.default.showHtml(2, data.data.count, data.data.is_leader, data.data.is_new), 'popup');
        _this3.setState({
          groupCount: data.data.count
        });
        if (data.data.is_leader === 1) {
          _Popup2.default.click('a.click', _utils.forwardApp);
          return;
        }
        _Popup2.default.click('a.click');
      });
    }
  }, {
    key: 'openTwo',
    value: function openTwo() {
      var _this4 = this;

      _Toast2.default.loading('');
      (0, _utils.get)('http://credit.xianjincard.com/activity/group-loan-act/group?tag=h5-20170421-groupLoan_act').then(function (data) {
        return data.data;
      }).then(function (data) {
        _Toast2.default.hide();
        if (data.code !== 0) {
          _Popup2.default.alert(_Content2.default.showHtml(data.code), 'popup');
          if (data.code === -1001) {
            _Popup2.default.click('a.click', function () {
              (0, _utils.login)(appMarket, _this4.inviteCode);
            });
            return;
          }
          if (data.code === -2003) {
            _Popup2.default.click('a.click', function () {
              (0, _utils.goHome)();
            });
            return;
          }
          _Popup2.default.click('a.click');
          return;
        }
        if (data.data.is_leader === 1) {
          window.location.reload();
          return;
        }
        _Popup2.default.alert(_Content2.default.showHtml(1, data.data.count, data.data.is_leader), 'popup');
        _Popup2.default.click('a.click');
      });
    }
  }, {
    key: 'forMy',
    value: function forMy() {
      var groupInviteCode = this.state.groupInviteCode;

      var url = 'http://h.xianjincard.com/activity/group-loan?invite_code=' + groupInviteCode;
      window.location.href = url;
    }
  }, {
    key: 'inviteBtn',
    value: function inviteBtn() {
      var _this5 = this;

      _Toast2.default.loading('');
      (0, _utils.get)('http://credit.xianjincard.com/activity/group-loan-act/group?tag=h5-20170421-groupLoan_act').then(function (data) {
        return data.data;
      }).then(function (data) {
        _Toast2.default.hide();
        if (data.code !== 0) {
          _Popup2.default.alert(_Content2.default.showHtml(data.code), 'popup');
          if (data.code === -1001) {
            _Popup2.default.click('a.click', function () {
              (0, _utils.login)(appMarket, _this5.inviteCode);
            });
            return;
          }
          if (data.code === -2003) {
            _Popup2.default.click('a.click', function () {
              (0, _utils.goHome)();
            });
            return;
          }
          _Popup2.default.click('a.click');
          return;
        }
        _Popup2.default.alert(_Content2.default.showHtml(2, data.data.count, data.data.is_leader), 'popup');
        _Popup2.default.click('a.click');
      });
    }
  }, {
    key: 'render',
    value: function render() {
      var _state = this.state,
          groupName = _state.groupName,
          groupCount = _state.groupCount,
          groupType = _state.groupType,
          type = _state.type,
          unix = _state.unix;

      var h1 = !type ? _react2.default.createElement('h1', null, '\u73B0\u91D1\u5361\u56E2\u501F\u7B2C\u4E00\u5F39') : _react2.default.createElement('h1', null, _react2.default.createElement('b', null, groupName), '\u56E2\u5DF2\u6709', _react2.default.createElement('b', null, groupCount), '\u4EBA');
      var h2 = !type ? '' : _react2.default.createElement('h2', null, '\u4E09\u4E94\u6210\u7FA4\uFF0C\u62C9\u5E2E\u7ED3\u6D3E\uFF0C\u7EC4\u56E2\u4EAB\u4F18\u60E0');
      var open = !type ? _react2.default.createElement('a', { className: 'open', onClick: this.open.bind(this) }, '\u6211\u8981\u5F00\u56E2') : null;
      var look = !type ? _react2.default.createElement('a', { className: 'look', onClick: this.open.bind(this) }, '\u67E5\u770B\u6211\u7684\u56E2') : null;
      var open1 = type && groupType === 0 ? _react2.default.createElement('a', { className: 'open', onClick: this.join.bind(this) }, '\u6211\u8981\u53C2\u56E2') : null;
      var look1 = type && groupType === 0 ? _react2.default.createElement('a', { className: 'look', onClick: this.openTwo.bind(this) }, '\u6211\u8981\u5F00\u56E2') : null;
      var forMy = type && groupType === 1 ? _react2.default.createElement('a', { className: 'center', onClick: this.forMy.bind(this) }, '\u8FDB\u5165\u6211\u7684\u56E2') : null;
      var inviteBtn = type && groupType === 2 ? _react2.default.createElement('a', { className: 'center', onClick: this.inviteBtn.bind(this) }, '\u7ACB\u5373\u9080\u8BF7') : null;
      var sr = unix ? _react2.default.createElement('div', { className: 'div-scroll' }, '\u6682\u65E0\u6392\u540D') : _react2.default.createElement(_Scroll2.default, { type: type });

      return _react2.default.createElement('div', { className: 'transition-group' }, _react2.default.createElement('div', { className: 'group-loan' }, _react2.default.createElement('header', { className: '' + (!type ? '' : 'notInApp') }, _react2.default.createElement('i', { className: 'rabbit1' }), _react2.default.createElement('i', { className: 'rabbit2' }), _react2.default.createElement('i', { className: 'rabbit3' }), h1, sr, h2), _react2.default.createElement('div', { className: 'content clearfix' }, _react2.default.createElement('div', { className: 'balloon clearfix' }, _react2.default.createElement('div', { className: 'balloon1' }, _react2.default.createElement('i', null), _react2.default.createElement('p', null, '\u7528\u6237\u7533\u8BF7\u501F\u6B3E\u540E\u70B9\u51FB\u6211\u8981\u5F00\u56E2\u5373\u53EF\u5F00\u56E2\u3002\u5F53\u56E2\u961F\u4EBA\u6570\u22655\u4EBA\u65F6\uFF0C\u5F00\u56E2\u4EBA\u5373\u83B77\u5929\u514D\u606F\u52381\u5F20')), _react2.default.createElement('div', { className: 'balloon2' }, _react2.default.createElement('i', null), _react2.default.createElement('p', null, '\u6D3B\u52A8\u7ED3\u675F\u524D\uFF0C5\u4EBA\u2264\u56E2\u961F\u4EBA\u6570\u226410\u4EBA\u7684\u53C2\u56E2\u7528\u6237\uFF0C\u9664\u5F00\u56E2\u4EBA\u5916\u5747\u53EF\u83B7\u5F975\u5929\u514D\u606F\u52381\u5F20'))), open, look, open1, look1, forMy, inviteBtn), _react2.default.createElement('div', { className: 'rule' }, _react2.default.createElement('h3', null, '\u6D3B\u52A8\u89C4\u5219'), _react2.default.createElement('p', null, _react2.default.createElement('span', null, '\u4E00'), '\u6D3B\u52A8\u65F6\u95F4\uFF1A2017\u5E745\u670817\u65E510:00\u2014\u20145\u670822\u65E50:00'), _react2.default.createElement('p', null, _react2.default.createElement('span', null, '\u4E8C'), '\u6D3B\u52A8\u5BF9\u8C61\uFF1A\u5E73\u53F0\u6240\u6709\u7528\u6237'), _react2.default.createElement('p', null, _react2.default.createElement('span', null, '\u4E09'), '\u5F00\u56E2\u89C4\u5219\uFF1A\u7533\u8BF7\u501F\u6B3E\u540E\u70B9\u51FB\u6211\u8981\u5F00\u56E2\uFF0C\u5373\u4E3A\u5F00\u56E2\u6210\u529F'), _react2.default.createElement('p', null, _react2.default.createElement('span', null, '\u56DB'), '\u53C2\u56E2\u89C4\u5219\uFF1A\u901A\u8FC7\u5F00\u56E2\u4EBA\u94FE\u63A5\u6CE8\u518C/\u767B\u5F55\u7684\u7528\u6237\uFF0C\u70B9\u51FB\u6211\u8981\u53C2\u56E2\uFF0C\u5373\u4E3A\u53C2\u56E2\u6210\u529F'), _react2.default.createElement('p', null, _react2.default.createElement('span', null, '\u4E94'), '\u6D3B\u52A8\u671F\u95F4\uFF0C\u6BCF\u4EBA\u4EC5\u53EF\u53C2\u4E0E1\u4E2A\u56E2'), _react2.default.createElement('p', null, _react2.default.createElement('span', null, '\u516D'), '\u67E5\u770B\u5956\u52B1\uFF1A', _react2.default.createElement('b', null, '\u6D3B\u52A8\u7ED3\u675F\u524D5\u4EBA\u2264\u56E2\u961F\u4EBA\u6570\u226410\u4EBA\uFF08\u542B\u5F00\u56E2\u4EBA\uFF09\uFF0C\u5F00\u56E2\u4EBA\u83B77\u5929\u514D\u606F\u52381\u5F20\uFF0C\u56E2\u961F\u6210\u5458\u83B75\u5929\u514D\u606F\u52381\u5F20\u3002'), '\u5956\u52B1\u53D1\u653E\u81F3APP-\u3010\u6211\u7684\u3011-\u3010\u4F18\u60E0\u5238\u3011\u4E2D\uFF0C\u8BF7\u6CE8\u610F\u67E5\u6536\uFF0C\u5238\u4F7F\u7528\u6709\u6548\u671F\uFF1A\u4ECE\u53D1\u653E\u4E4B\u65E5\u8D7715\u5929\u5185'), _react2.default.createElement('p', null, _react2.default.createElement('span', null, '\u4E03'), '\u672C\u6D3B\u52A8\u6700\u7EC8\u89E3\u91CA\u6743\u5F52\u73B0\u91D1\u5361\u6240\u6709\uFF0C\u4E0EApple.Inc\u65E0\u5173'))));
    }
  }]);
  return GroupLoan;
}(_react2.default.Component);

exports.default = GroupLoan;
module.exports = exports['default'];