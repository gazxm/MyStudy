{"version":3,"sources":["src\\js\\pages\\mobile\\certification\\credit\\index.js"],"names":["Item","alert","TiedCard","props","document","title","state","disabled","phone","data","name","list","fetchData","loading","then","hide","response","code","message","info","item","length","push","setState","catch","form","validateFields","error","value","bank_id","replace","card_no","undefined","success","val","keys","Array","isArray","test","getFieldProps","onChange","bind","rules","required","onChangePhone","pattern","validateFirst","sendCode","submit","Component"],"mappings":"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","file":"index.js","sourceRoot":"E:/MyStudy/Redux/app_four","sourcesContent":["import React from 'react'\r\nimport { Modal, List, Button, Picker, InputItem, Toast } from 'antd-mobile'\r\nimport { createForm } from 'rc-form'\r\nimport Timer from 'components/Timer'\r\nimport {redirect, post} from 'utils'\r\n\r\nconst Item = List.Item\r\nconst alert = Modal.alert\r\n\r\nimport 'scss/mobile/credit-tied.component.scss'\r\n\r\nclass TiedCard extends React.Component {\r\n  constructor (props) {\r\n    super(props)\r\n    document.title = '认证信用卡'\r\n    this.state = {\r\n      disabled: true,\r\n      phone: false,\r\n      data: {\r\n        name: '',\r\n        list: []\r\n      }\r\n    }\r\n  }\r\n  componentDidMount () {\r\n    this.fetchData()\r\n  }\r\n  fetchData () {\r\n    Toast.loading('加载中...', 0)\r\n    post('https://credit.xianjincard.com/credit-card/get-credit-card-list').then(response => {\r\n      Toast.hide()\r\n      const {code, message, data} = response.data\r\n      if (code !== 0) {\r\n        Toast.info(message, 2)\r\n        return\r\n      }\r\n      // 已绑定过信用卡\r\n      if (data.item && data.item.length > 0) {\r\n        redirect.push('/mobile/certification/credit/verify')\r\n        return\r\n      }\r\n      this.setState({data: data})\r\n    }).catch(response => {\r\n      Toast.hide();\r\n    });\r\n  }\r\n  sendCode () {\r\n    post('https://credit.xianjincard.com/credit-card/get-code', {phone: this.state.phone}).then((response) => {\r\n      // console.log(response)\r\n      if (response.data.code !== 0) {\r\n        Toast.info(response.data.message, 2)\r\n      }\r\n    }).catch(response => response)\r\n  }\r\n  submit () {\r\n    this.props.form.validateFields((error, value) => {\r\n      if (!error) {\r\n        value.bank_id = value.bank_id[0]\r\n        value.phone = value.phone.replace(/\\s/g, '')\r\n        value.card_no = value.card_no.replace(/\\s/g, '')\r\n        Toast.loading(undefined, 0);\r\n        post('https://credit.xianjincard.com/credit-card/add-credit-card', value).then(response => {\r\n          const {code, message} = response.data\r\n          if (code !== 0) {\r\n            Toast.info(message, 3)\r\n            return\r\n          }\r\n          Toast.success(message, () => {\r\n            redirect.push('/mobile/certification/credit/verify');\r\n          });\r\n        })\r\n      }\r\n    })\r\n  }\r\n  onChange (val) {\r\n    this.props.form.validateFields((error, value) => {\r\n      this.setState({disabled: error})\r\n\r\n      if (error) {\r\n        const keys = Object.keys(error)\r\n        if (keys.length === 1 && keys[0] === 'bank_id' && Array.isArray(val)) {\r\n          this.setState({disabled: false})\r\n        }\r\n      }\r\n    })\r\n\r\n    if (!val) {\r\n      this.setState({disabled: !val})\r\n    }\r\n  }\r\n  onChangePhone (val) {\r\n    this.setState({phone: /^1[34578]\\d{9}$/.test(val) && val})\r\n  }\r\n  render () {\r\n    const {getFieldProps} = this.props.form\r\n    const {name, list} = this.state.data\r\n    return (\r\n      <div class=\"transition-group credit-tied-card\">\r\n        <List class=\"custom-list\">\r\n          <InputItem value={name} editable={false} >姓名</InputItem>\r\n          <Picker extra=\"请选择银行\" cols={1} data={list} { ...getFieldProps('bank_id', {onChange: this.onChange.bind(this), rules: [{required: true, message: '请选择银行'}]})} title=\"请选择银行\">\r\n            <Item arrow=\"horizontal\"> 请选择银行 </Item>\r\n          </Picker>\r\n          <InputItem placeholder=\"请输入信用卡卡号\" type=\"tel\" {...getFieldProps('card_no', {onChange: this.onChange.bind(this), rules: [{required: true, message: '请输入信用卡卡号'}]})}>银行卡号</InputItem>\r\n          <InputItem placeholder=\"请输入银行预留手机号\" maxLength={11} type=\"tel\" {...getFieldProps('phone', {onChange: this.onChangePhone.bind(this), rules: [{required: true, pattern: /^1[34578]\\d{9}$/, message: '请输入正确手机号'}]})}>手机号</InputItem>\r\n          <InputItem placeholder=\"请输入验证码\" type=\"tel\" {...getFieldProps('code', {validateFirst: true, onChange: this.onChange.bind(this), rules: [{required: true, message: '请输入验证码'}]})}>验证码 <Timer disabled={!this.state.phone} class=\"timer\" onSend={this.sendCode.bind(this)}/></InputItem>\r\n        </List>\r\n\r\n        <div class=\"custom-button\">\r\n          <Button className=\"btn\" disabled={this.state.disabled} type=\"primary\" onClick={this.submit.bind(this)}>确认绑卡</Button>\r\n        </div>\r\n        <div class=\"security-info\">银行级数据加密保护</div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default createForm()(TiedCard)\r\n"]}