{"version":3,"sources":["src\\js\\pages\\activity\\scratch-card\\Scratch.js"],"names":["totalLength","rewardFlag","toastFlag","width","height","Scratch","props","state","total","prizeList","times","exchangeGold","isApp","document","body","className","loading","then","data","hide","code","alert","showHtml","click","setState","formatTotal","person","prize_list","exchange_gold","title","getElementsByClassName","offsetWidth","offsetHeight","init","refs","lotteryContainer","scratch","bind","per","rewardHtml","addEventListener","prize_sn","info","setTimeout","array","num","length","i","ruleHtml","myReward","map","v","push","li","overlay","showRule","refresh","exchange","reward","Component"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;AACA;;AACA;;;;;;AAEA,IAAM,cAAN,AAAoB;AACpB,IAAI,aAAJ,AAAiB;AACjB,IAAI,YAAJ,AAAgB;AAChB,IAAI,QAAJ,AAAY;AACZ,IAAI,SAAJ,AAAa;;I,AAEQ;mCACnB;;mBAAA,AAAa,OAAO;wCAAA;;wIAAA,AACZ,AACN;;UAAA,AAAK;aACI,CAAA,AAAC,GAAD,AAAI,GAAJ,AAAO,GAAP,AAAU,GAAV,AAAa,GAAb,AAAgB,GADZ,AACJ,AAAmB,AAC1B;iBAFW,AAEA,AACX;aAHW,AAGJ,AACP;oBANgB,AAElB,AAAa,AAIG;AAJH,AACX;WAKH;;;;;yCAEqB;mBACpB;;UAAI,CAAC,gBAAL,AAAc,OAAO,AACnB;iBAAA,AAAS,KAAT,AAAc,YAAd,AAA0B,AAC3B;AACD;sBAAA,AAAM,QAAN,AAAc,AACd;sBAAA,AAAI,4DAAJ,AAAgE,KAAK,gBAAA;eAAQ,KAAR,AAAa;AAAlF,SAAA,AAAwF,KAAK,gBAAQ,AACnG;wBAAA,AAAM,AACN;YAAI,KAAA,AAAK,SAAT,AAAkB,GAAG,AACnB;0BAAA,AAAM,MAAM,kBAAA,AAAQ,SAAS,KAA7B,AAAY,AAAsB,OAAlC,AAAyC,AACzC;cAAI,KAAA,AAAK,SAAS,CAAlB,AAAmB,MAAM,AACvB;4BAAA,AAAM,MAAN,AAAY,kBACZ;AACD;AACD;0BAAA,AAAM,MAAN,AAAY,AACZ;AACD;AACD;eAAA,AAAK;iBACI,OAAA,AAAK,YAAY,KAAA,AAAK,KADjB,AACL,AAA2B,AAClC;qBAAW,KAAA,AAAK,KAFJ,AAES,AACrB;iBAAO,KAAA,AAAK,KAHA,AAGK,AACjB;wBAAc,KAAA,AAAK,KAJrB,AAAc,AAIY,AAE3B;AANe,AACZ;AAZJ,AAkBD;;;;wCAEoB,AACnB;eAAA,AAAS,QAAT,AAAiB,AACjB;wBAAA,AAAM,AACN;cAAQ,SAAA,AAAS,uBAAT,AAAgC,UAAhC,AAA0C,GAAlD,AAAqD,AACrD;eAAS,SAAA,AAAS,uBAAT,AAAgC,UAAhC,AAA0C,GAAnD,AAAsD,AACtD;WAAA,AAAK,AACN;;;;2BAEO,AACN;wBAAA,AAAQ,KAAK,KAAA,AAAK,KAAlB,AAAuB,kBAAvB,AAAyC,sDAAzC,AAA+F,SAA/F,AAAwG,OAAxG,AAA+G,QAA/G,AAAuH,IAAvH,AAA2H,IAA3H,AAA+H,sDAA/H,AAAqL,SAAS,KAAA,AAAK,QAAL,AAAa,KAA3M,AAA8L,AAAkB,AACjN;;;;4B,AAEQ,KAAK;mBACZ;;UAAI,MAAA,AAAM,MAAV,AAAgB,YAAY,AAC1B;qBAAA,AAAa,AACb;wBAAA,AAAM,QAAN,AAAc,AACd;wBAAA,AAAI,8DAAJ,AAAkE,KAAK,gBAAA;iBAAQ,KAAR,AAAa;AAApF,WAAA,AAA0F,KAAK,gBAAQ,AACrG;0BAAA,AAAM,AACN;0BAAA,AAAM,MAAM,kBAAA,AAAQ,WAAW,KAAnB,AAAwB,MAAM,gBAA1C,AAAY,AAAuC,QAAnD,AAA2D,AAC3D;0BAAA,AAAM,iBAAN,AAAuB,UAAvB,AAAiC,SAAS,YAAM,AAC9C;6BAAK,KAAA,AAAK,KAAV,AAAe,AAChB;AAFD,AAGA;iBAAA,AAAK;mBACI,EAAE,OAAA,AAAK,MADhB,AAAc,AACQ,AAEvB;AAHe,AACZ;AAPJ,AAUD;AACD;UAAI,MAAA,AAAM,MAAV,AAAgB,WAAW,AACzB;oBAAA,AAAY,AACZ;wBAAA,AAAM,KAAN,AAAW,WAAX,AAAsB,AACtB;mBAAW,YAAM,AACf;sBAAA,AAAY,AACb;AAFD,WAAA,AAEG,AACJ;AACF;;;;gC,AAEY,OAAO,AAClB;UAAI,QAAJ,AAAY,AACZ;UAAI,MAAM,QAAV,AAAkB,AAClB;UAAI,SAAS,IAAb,AAAiB,AACjB;UAAI,SAAJ,AAAa,aAAa,AACxB;aAAK,IAAI,IAAT,AAAa,GAAG,IAAI,cAApB,AAAkC,QAAlC,AAA0C,KAAK,AAC7C;gBAAM,MAAN,AAAY,AACb;AACF;AACD;WAAK,IAAI,KAAT,AAAa,GAAG,KAAI,IAApB,AAAwB,QAAxB,AAAgC,MAAK,AACnC;2DAAA,AAAY,yCAAU,IAAtB,AAAsB,AAAI,AAC3B;AACD;aAAA,AAAO,AACR;;;;+BAEW;UAAA,AACF,eAAiB,KADf,AACoB,MADpB,AACF,AACR;;sBAAA,AAAM,MAAM,kBAAA,AAAQ,SAApB,AAAY,AAAiB,eAA7B,AAA4C,AAC7C;;;;6BAES;UAAA,AACA,YAAc,KADd,AACmB,MADnB,AACA,AAER;;sBAAA,AAAM,MAAM,kBAAA,AAAQ,SAAR,AAAiB,WAAW,gBAAxC,AAAY,AAAqC,QAAjD,AAAyD,AACzD;gBAAA,AAAU,IAAI,UAAA,AAAC,GAAD,AAAI,GAAM,AACtB;wBAAA,AAAM,6BAAN,AAAiC,GAAjC,AAAsC,SAAS,YAAM,AACnD;2BAAK,EAAL,AAAO,AACR;AAFD,AAGD;AAJD,AAKD;;;;+BAEW;mBACV;;sBAAA,AAAM,QAAN,AAAc,AACd;sBAAA,AAAI,+DAAJ,AAAmE,KAAK,gBAAA;eAAQ,KAAR,AAAa;AAArF,SAAA,AAA2F,KAAK,gBAAQ,AACtG;wBAAA,AAAM,AACN;wBAAA,AAAM,MAAM,kBAAA,AAAQ,SAAS,KAA7B,AAAY,AAAsB,OAAlC,AAAyC,AACzC;YAAI,KAAA,AAAK,SAAT,AAAkB,GAAG,AACnB;cAAI,KAAA,AAAK,SAAS,CAAlB,AAAmB,MAAM,AACvB;4BAAA,AAAM,MAAN,AAAY,kBACZ;AACD;AACD;cAAI,KAAA,AAAK,SAAS,CAAlB,AAAmB,MAAM,AACvB;4BAAA,AAAM,MAAN,AAAY,WAAW,YAAM,AAC3B;8BAAA,AAAS,KAAT,AAAc,AACf;AAFD,AAGA;AACD;AACF;AACD;wBAAA,AAAM,MAAN,AAAY,AACZ;eAAA,AAAK;iBACI,EAAE,OAAA,AAAK,MADhB,AAAc,AACQ,AAEvB;AAHe,AACZ;AAjBJ,AAoBD;;;;8BAEU,AACT;sBAAA,AAAM,MAAM,kBAAA,AAAQ,SAAS,CAA7B,AAAY,AAAkB,OAA9B,AAAqC,AACrC;sBAAA,AAAM,MAAN,AAAY,kBACb;;;;8BAEU,AACT;WAAA,AAAK,AACL;mBAAA,AAAa,AACd;;;;6BAES;mBACiB,KADjB,AACsB;UADtB,AACA,eADA,AACA;UADA,AACO,eADP,AACO,AAEf;;UAAM,WAAK,AAAM,IAAI,UAAA,AAAC,GAAD,AAAI,GAAJ;eAAU,gBAAA,cAAA,QAAI,KAAJ,AAAS,AAAI,KAAvB,AAAU;AAA/B,AAAW,AACX,OADW;UACL,UAAU,QAAA,AAAQ,IAAI,uCAAK,WAAL,AAAe,WAAU,SAAS,KAAA,AAAK,QAAL,AAAa,KAA3D,AAAY,AAAkC,AAAkB,WAAhF,AAA4F,AAE5F;;aACE,gBAAA,cAAA,SAAK,WAAL,AAAe,AACb,sCAAA,cAAA,SAAK,WAAL,AAAe,AACb,6BAAA,cAAA,OAAG,WAAH,AAAa,QAAO,SAAS,KAAA,AAAK,SAAL,AAAc,KAA3C,AAA6B,AAAmB,SADlD,AACE,AACA,6CAAA,cAAA,SAAK,WAAL,AAAe,AACb,6BAAA,cAAA,SAAK,WAAL,AAAe,AACb,yCAAA,cAAA,QAAA,MAAQ,oDAAR,OADF,AACE,AACA,iCAAA,cAAA,MACG,MAJP,AACE,AAEE,AAIF,sBAAA,cAAA,MAAA,MAAS,kDAAA,cAAA,KAAI,MAAb,AAAS,QAPX,AAOE,AACA,mDAAA,cAAA,SAAK,WAAL,AAAe,AACZ,oBADH,AAEE,8CAAG,SAAS,KAAA,AAAK,QAAL,AAAa,KAF3B,AAEE,AAAY,AAAkB,AAC9B,iDAAK,KAAL,AAAS,oBAAmB,WAXhC,AAQE,AAGE,AAAsC,AAExC,8BAAA,cAAA,OAAG,WAAH,AAAa,YAAW,SAAS,KAAA,AAAK,SAAL,AAAc,KAA/C,AAAiC,AAAmB,SAbtD,AAaE,AACA,qEAAA,cAAA,OAAG,WAAH,AAAa,UAAS,SAAS,KAAA,AAAK,OAAL,AAAY,KAA3C,AAA+B,AAAiB,SAlBxD,AACE,AACE,AAEE,AAcE,AAKT;;;;EAtKkC,gBAAM,A;;kBAAtB,A","file":"Scratch.js","sourceRoot":"E:/MyStudy/Redux/app_four","sourcesContent":["import React from 'react'\r\nimport Content from './Content'\r\nimport Lottery from '../components/Lottery'\r\nimport Popup from '../components/Popup'\r\nimport Toast from '../../../components/Toast'\r\nimport { get, share, platform, login, redirect, goHome, copy } from 'utils'\r\nimport 'scss/activity/scratch.component.scss'\r\nimport 'img/activity/scratch-card/scratch-04.jpg'\r\nimport 'img/activity/scratch-card/scratch-10.jpg'\r\n\r\nconst totalLength = 7\r\nlet rewardFlag = 1\r\nlet toastFlag = 1\r\nlet width = 0\r\nlet height = 0\r\n\r\nexport default class Scratch extends React.Component {\r\n  constructor (props) {\r\n    super(props)\r\n    this.state = {\r\n      total: [0, 0, 0, 0, 0, 0, 0],\r\n      prizeList: [],\r\n      times: 0,\r\n      exchangeGold: 0\r\n    }\r\n  }\r\n\r\n  componentWillMount () {\r\n    if (!platform.isApp) {\r\n      document.body.className = 'copy'\r\n    }\r\n    Toast.loading('')\r\n    get('http://credit.xianjincard.com/activity/scratch-act/index').then(data => data.data).then(data => {\r\n      Toast.hide()\r\n      if (data.code !== 0) {\r\n        Popup.alert(Content.showHtml(data.code), 'popup-show')\r\n        if (data.code === -1001) {\r\n          Popup.click('a.click', login)\r\n          return\r\n        }\r\n        Popup.click('a.click')\r\n        return\r\n      }\r\n      this.setState({\r\n        total: this.formatTotal(data.data.person),\r\n        prizeList: data.data.prize_list,\r\n        times: data.data.times,\r\n        exchangeGold: data.data.exchange_gold\r\n      })\r\n    })\r\n  }\r\n\r\n  componentDidMount () {\r\n    document.title = '惊喜刮刮乐'\r\n    share('scratch')\r\n    width = document.getElementsByClassName('canvas')[0].offsetWidth\r\n    height = document.getElementsByClassName('canvas')[0].offsetHeight\r\n    this.init()\r\n  }\r\n\r\n  init () {\r\n    Lottery.init(this.refs.lotteryContainer, '../assets/img/activity/scratch-card/scratch-04.jpg', 'image', width, height, 50, 60, '../assets/img/activity/scratch-card/scratch-10.jpg', 'image', this.scratch.bind(this))\r\n  }\r\n\r\n  scratch (per) {\r\n    if (per > 35 && rewardFlag) {\r\n      rewardFlag = 0\r\n      Toast.loading('')\r\n      get('http://credit.xianjincard.com/activity/scratch-act/scratch').then(data => data.data).then(data => {\r\n        Toast.hide()\r\n        Popup.alert(Content.rewardHtml(data.data, platform.isApp), 'popup-reward')\r\n        Popup.addEventListener('a.copy', 'click', () => {\r\n          copy(data.data.prize_sn)\r\n        })\r\n        this.setState({\r\n          times: --this.state.times\r\n        })\r\n      })\r\n    }\r\n    if (per < 35 && toastFlag) {\r\n      toastFlag = 0\r\n      Toast.info('请在多刮一点哦', 2)\r\n      setTimeout(() => {\r\n        toastFlag = 1\r\n      }, 2200)\r\n    }\r\n  }\r\n\r\n  formatTotal (total) {\r\n    let array = []\r\n    let num = total + ''\r\n    let length = num.length\r\n    if (length < totalLength) {\r\n      for (let i = 0; i < totalLength - length; i++) {\r\n        num = '0' + num\r\n      }\r\n    }\r\n    for (let i = 0; i < num.length; i++) {\r\n      array = [...array, ...num[i]]\r\n    }\r\n    return array\r\n  }\r\n\r\n  showRule () {\r\n    const { exchangeGold } = this.state\r\n    Popup.alert(Content.ruleHtml(exchangeGold), 'popup-rule')\r\n  }\r\n\r\n  reward () {\r\n    const { prizeList } = this.state\r\n\r\n    Popup.alert(Content.myReward(prizeList, platform.isApp), 'popup-my')\r\n    prizeList.map((v, i) => {\r\n      Popup.addEventListener(`a.copy-${i}`, 'click', () => {\r\n        copy(v.prize_sn)\r\n      })\r\n    })\r\n  }\r\n\r\n  exchange () {\r\n    Toast.loading('')\r\n    get('http://credit.xianjincard.com/activity/scratch-act/exchange').then(data => data.data).then(data => {\r\n      Toast.hide()\r\n      Popup.alert(Content.showHtml(data.code), 'popup-show')\r\n      if (data.code !== 0) {\r\n        if (data.code === -1001) {\r\n          Popup.click('a.click', login)\r\n          return\r\n        }\r\n        if (data.code === -2031) {\r\n          Popup.click('a.click', () => {\r\n            redirect.push('/signin')\r\n          })\r\n          return\r\n        }\r\n      }\r\n      Popup.click('a.click')\r\n      this.setState({\r\n        times: ++this.state.times\r\n      })\r\n    })\r\n  }\r\n\r\n  overlay () {\r\n    Popup.alert(Content.showHtml(-2100), 'popup-show')\r\n    Popup.click('a.click', goHome)\r\n  }\r\n\r\n  refresh () {\r\n    this.init()\r\n    rewardFlag = 1\r\n  }\r\n\r\n  render () {\r\n    const { total, times } = this.state\r\n\r\n    const li = total.map((v, i) => <li key={i}>{v}</li>)\r\n    const overlay = times < 0 ? <div className='overlay' onClick={this.overlay.bind(this)} /> : null\r\n\r\n    return (\r\n      <div className='transition-group'>\r\n        <div className='scratch'>\r\n          <a className='rule' onClick={this.showRule.bind(this)}>活动锦囊</a>\r\n          <div className='content'>\r\n            <div className='join-total clearfix'>\r\n              <span>参加<br />人数</span>\r\n              <ul>\r\n                {li}\r\n              </ul>\r\n            </div>\r\n            <h3>您今天还有<b>{times}</b>次抽奖机会</h3>\r\n            <div className='canvas-content'>\r\n              {overlay}\r\n              <i onClick={this.refresh.bind(this)} />\r\n              <div ref='lotteryContainer' className='canvas' />\r\n            </div>\r\n            <a className='exchange' onClick={this.exchange.bind(this)}>金币兑换抽奖机会</a>\r\n            <a className='reward' onClick={this.reward.bind(this)}>我的奖品</a>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n"]}