'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _css = require('antd-mobile/lib/refresh-control/style/css');

var _refreshControl = require('antd-mobile/lib/refresh-control');

var _refreshControl2 = _interopRequireDefault(_refreshControl);

var _css2 = require('antd-mobile/lib/icon/style/css');

var _icon = require('antd-mobile/lib/icon');

var _icon2 = _interopRequireDefault(_icon);

var _css3 = require('antd-mobile/lib/list-view/style/css');

var _listView = require('antd-mobile/lib/list-view');

var _listView2 = _interopRequireDefault(_listView);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _css4 = require('antd-mobile/lib/list/style/css');

var _list = require('antd-mobile/lib/list');

var _list2 = _interopRequireDefault(_list);

var _class, _temp;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _utils = require('utils');

var _Toast = require('components/Toast');

var _Toast2 = _interopRequireDefault(_Toast);

require('scss/mobile/me.component.scss');

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

var Item = _list2.default.Item;
var Brief = Item.Brief;

var Me = (_temp = _class = function (_React$Component) {
  (0, _inherits3.default)(Me, _React$Component);

  function Me(props) {
    (0, _classCallCheck3.default)(this, Me);

    var _this = (0, _possibleConstructorReturn3.default)(this, (Me.__proto__ || (0, _getPrototypeOf2.default)(Me)).call(this, props));

    _this.al = 0;
    _this.progress = 0;
    var dataSource = new _listView2.default.DataSource({
      rowHasChanged: function rowHasChanged(row1, row2) {
        return row1 !== row2;
      }
    });
    _this.data = [];
    _this.state = {
      dataSource: dataSource.cloneWithRows([_this.data]),
      refreshing: true
    };
    return _this;
  }

  (0, _createClass3.default)(Me, [{
    key: 'componentDidMount',
    value: function componentDidMount() {
      document.title = '个人中心';
      // this.setState({refreshing: true})
    }
  }, {
    key: 'fetchData',
    value: function fetchData() {
      var _this2 = this;

      (0, _utils.get)('http://credit.xianjincard.com/credit-loan/get-my-orders').then(function (result) {
        // console.log(result)
        if (result.data.code !== 0) {
          _Toast2.default.info(result.data.message, 2);
          return;
        }
        _this2.data = result.data.data.item;
        _this2.setState({
          dataSource: _this2.state.dataSource.cloneWithRows([_this2.data]),
          refreshing: false
        });
      }).catch(function (error) {
        console.log(error);
      });
    }
  }, {
    key: 'onRefresh',
    value: function onRefresh() {
      this.setState({ refreshing: true });
      this.fetchData();
    }
  }, {
    key: 'onClick',
    value: function onClick(item) {
      location.href = item.url;
    }
  }, {
    key: 'list',
    value: function list(items) {
      var _this3 = this;

      if (items.length > 0) {
        return items.map(function (v, i) {
          return _react2.default.createElement(Item, { key: i, multipleLine: true, extra: _react2.default.createElement('div', { dangerouslySetInnerHTML: { __html: v.text.replace(/size="\d"/, '') } }), arrow: 'horizontal', onClick: _this3.onClick.bind(_this3, v) }, v.title, _react2.default.createElement(Brief, null, v.time));
        });
      }
      if (items.length <= 0 && !this.state.refreshing) return _react2.default.createElement('div', { className: 'order-nothing' }, '\u4F60\u8FD8\u6CA1\u6709\u501F\u6B3E\u8BB0\u5F55\u54E6~');
    }
  }, {
    key: 'render',
    value: function render() {
      var _this4 = this;

      var row = function row(rowData, sectionID, rowID) {
        return _react2.default.createElement(_list2.default, { className: 'me' }, _this4.list(rowData));
      };
      return _react2.default.createElement(_listView2.default, {
        className: 'xjk-refresh',
        dataSource: this.state.dataSource,
        renderRow: row,
        initialListSize: 5,
        pageSize: 5,
        scrollRenderAheadDistance: 200,
        scrollEventThrottle: 20,
        style: {
          height: document.documentElement.clientHeight
        },
        refreshControl: _react2.default.createElement(_refreshControl2.default, {
          refreshing: this.state.refreshing,
          icon: [_react2.default.createElement('div', { key: '0', className: 'am-refresh-control-pull' }, _react2.default.createElement(_icon2.default, { type: 'arrow-down' }), _react2.default.createElement('span', null, '\u79D1\u6280\u8BA9\u91D1\u878D\u66F4\u7B80\u5355')), _react2.default.createElement('div', { key: '1', className: 'am-refresh-control-release' }, _react2.default.createElement(_icon2.default, { type: 'arrow-up' }), _react2.default.createElement('span', null, '\u79D1\u6280\u8BA9\u91D1\u878D\u66F4\u7B80\u5355'))],
          distanceToRefresh: 80 / 2 * (window.devicePixelRatio || 2),
          onRefresh: this.onRefresh.bind(this) }) });
    }
  }]);
  return Me;
}(_react2.default.Component), _class.contextTypes = {
  router: _react2.default.PropTypes.object
}, _temp);
exports.default = Me;
module.exports = exports['default'];